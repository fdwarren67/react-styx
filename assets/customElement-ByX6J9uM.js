import{e as A,f as p,i as h,x as d,j as y,M as P,S as w}from"./index-5Uv45sI4.js";import{n as k}from"./ref-DqiYxcul.js";import{i as b}from"./keyed-Dd7AOvr1.js";import{o as I,p as D}from"./dom-DJEv2Q-P.js";import{m as M,p as T}from"./interactive-BKbZm5P7.js";import{b as O}from"./observers-CKvzzITU.js";import{i as u,c as v,h as R,a as F,p as E,o as U}from"./utils-B19IB7gH.js";import{D as G,I as N}from"./sortableComponent-DcctxQH5.js";import{n as C}from"./resources-DodJkxAw.js";import{m as H}from"./component-Dxbaltlt.js";import{q as x}from"./locale-s9NCZ3Zl.js";import{i as z}from"./guid-BDWAkmkV.js";import{s as q}from"./useT9n-Cwowg6_C.js";import{d as B}from"./debounce-DbkufipY.js";import"./logger-CuHV5ymd.js";import"./key-ak3_eHKH.js";/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.1.0 */const m={container:"container",table:"table",scrim:"scrim",stack:"stack",tableContainer:"table-container",sticky:"sticky-pos",assistiveText:"assistive-text"},L={filterNoResults:"filter-no-results",filterActionsStart:"filter-actions-start",filterActionsEnd:"filter-actions-end"},K=y`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}.container{position:relative;background-color:var(--calcite-list-background-color, var(--calcite-color-foreground-1))}.table-container{box-sizing:border-box;display:flex;inline-size:100%;flex-direction:column;background-color:transparent}.table-container *{box-sizing:border-box}.table{inline-size:100%}.stack{--calcite-stack-padding-inline: 0;--calcite-stack-padding-block: 0}.sticky-pos{position:sticky;inset-block-start:0px;z-index:var(--calcite-z-index-sticky);background-color:var(--calcite-list-background-color, var(--calcite-color-foreground-1))}.assistive-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}`,j=`${F}, ${u}`,g=class g extends A{constructor(){super(),this.dragSelector=u,this.focusableItems=[],this.handleSelector="calcite-sort-handle",this.listItems=[],this.listItemGroups=[],this.mutationObserver=O("mutation",()=>{this.willPerformFilter=!0,this.updateListItems()}),this.updateListItems=B(()=>{this.updateGroupItems();const{selectionAppearance:e,selectionMode:t,interactionMode:i,dragEnabled:l,el:a,filterEl:s,moveToItems:o,displayMode:r,scale:c}=this,f=Array.from(this.el.querySelectorAll(u));if(f.forEach(n=>{n.scale=c,n.selectionAppearance=e,n.selectionMode=t,n.interactionMode=i,n.closest(v)===a&&(n.moveToItems=o.filter($=>$.element!==a&&!n.contains($.element)),n.dragHandle=l,n.displayMode=r)}),this.parentListEl){this.setUpSorting();return}this.listItems=f,this.filterEnabled&&this.willPerformFilter&&(this.willPerformFilter=!1,this.dataForFilter=this.getItemData(),s&&(s.items=this.dataForFilter,this.filterAndUpdateData())),this.visibleItems=this.listItems.filter(n=>!n.closed&&!n.hidden),this.updateFilteredItems(),this.borderItems(),this.focusableItems=this.filteredItems.filter(n=>!n.disabled),this.setActiveListItem(),this.updateSelectedItems(),this.setUpSorting()},P.nextTick),this.visibleItems=[],this.willFilterEmit=!1,this.willPerformFilter=!1,this.dataForFilter=[],this.hasFilterActionsEnd=!1,this.hasFilterActionsStart=!1,this.hasFilterNoResults=!1,this.moveToItems=[],this.disabled=!1,this.dragEnabled=!1,this.filterEnabled=!1,this.filteredData=[],this.filteredItems=[],this.interactionMode="interactive",this.loading=!1,this.messages=q({blocking:!0}),this.displayMode="flat",this.scale="m",this.selectedItems=[],this.selectionAppearance="icon",this.selectionMode="none",this.calciteInternalListDefaultSlotChange=p({cancelable:!1}),this.calciteListChange=p({cancelable:!1}),this.calciteListDragEnd=p({cancelable:!1}),this.calciteListDragStart=p({cancelable:!1}),this.calciteListFilter=p({cancelable:!1}),this.calciteListOrderChange=p({cancelable:!1}),this.listen("calciteInternalListItemToggle",this.handleCalciteListItemToggle),this.listen("calciteInternalFocusPreviousItem",this.handleCalciteInternalFocusPreviousItem),this.listen("calciteInternalListItemActive",this.handleCalciteInternalListItemActive),this.listen("calciteListItemSelect",this.handleCalciteListItemSelect),this.listen("calciteInternalAssistiveTextChange",this.handleCalciteInternalAssistiveTextChange),this.listen("calciteSortHandleReorder",this.handleSortReorder),this.listen("calciteSortHandleMove",this.handleSortMove),this.listen("calciteInternalListItemSelect",this.handleCalciteInternalListItemSelect),this.listen("calciteInternalListItemSelectMultiple",this.handleCalciteInternalListItemSelectMultiple),this.listen("calciteInternalListItemChange",this.handleCalciteInternalListItemChange),this.listen("calciteInternalListItemGroupDefaultSlotChange",this.handleCalciteInternalListItemGroupDefaultSlotChange)}get hasActiveFilter(){return this.filterEnabled&&this.filterText&&this.filteredItems.length!==this.visibleItems.length}get showNoResultsContainer(){return this.filterEnabled&&this.filterText&&this.hasFilterNoResults&&this.visibleItems.length&&!this.filteredItems.length}async setFocus(){var e,t;return await H(this),this.filterEnabled?(e=this.filterEl)==null?void 0:e.setFocus():(t=this.focusableItems.find(i=>i.active))==null?void 0:t.setFocus()}connectedCallback(){super.connectedCallback(),this.connectObserver(),this.willPerformFilter=!0,this.updateListItems(),this.setUpSorting(),this.setParentList(),this.setListItemGroups()}async load(){this.handleInteractionModeWarning()}willUpdate(e){(e.has("filterText")||e.has("filterProps")||e.has("filterPredicate"))&&this.performFilter(),(e.has("filterEnabled")&&(this.hasUpdated||this.filterEnabled!==!1)||e.has("group")||e.has("dragEnabled")&&(this.hasUpdated||this.dragEnabled!==!1)||e.has("selectionMode")&&(this.hasUpdated||this.selectionMode!=="none")||e.has("selectionAppearance")&&(this.hasUpdated||this.selectionAppearance!=="icon")||e.has("displayMode")&&this.hasUpdated||e.has("scale")&&this.hasUpdated||e.has("filterPredicate")&&this.hasUpdated)&&this.handleListItemChange()}updated(){M(this)}disconnectedCallback(){super.disconnectedCallback(),this.disconnectObserver(),G(this)}handleListItemChange(){this.willPerformFilter=!0,this.updateListItems()}handleCalciteListItemToggle(e){this.parentListEl||(e.stopPropagation(),this.borderItems())}handleCalciteInternalFocusPreviousItem(e){if(this.parentListEl)return;e.stopPropagation();const{focusableItems:t}=this,i=t.findIndex(l=>l.active)-1;t[i]&&this.focusRow(t[i])}handleCalciteInternalListItemActive(e){if(this.parentListEl)return;e.stopPropagation();const t=e.target,{listItems:i}=this;i.forEach(l=>{l.active=l===t})}handleCalciteListItemSelect(){this.parentListEl||this.updateSelectedItems(!0)}handleCalciteInternalAssistiveTextChange(e){this.assistiveText=e.detail.message,e.stopPropagation()}handleSortReorder(e){this.parentListEl||this.handleReorder(e)}handleSortMove(e){this.parentListEl||this.handleMove(e)}handleCalciteInternalListItemSelect(e){if(this.parentListEl)return;e.stopPropagation();const t=e.target,{listItems:i,selectionMode:l}=this;t.selected&&(l==="single"||l==="single-persist")&&i.forEach(a=>a.selected=a===t),this.updateSelectedItems()}handleCalciteInternalListItemSelectMultiple(e){if(this.parentListEl)return;e.stopPropagation();const{target:t,detail:i}=e,{focusableItems:l,lastSelectedInfo:a}=this,s=t;if(i.selectMultiple&&a){const o=l.indexOf(s),r=l.indexOf(a.selectedItem),c=Math.min(r,o),f=Math.max(r,o);l.slice(c,f+1).forEach(n=>n.selected=a.selected)}else this.lastSelectedInfo={selectedItem:s,selected:s.selected}}handleCalciteInternalListItemChange(e){this.parentListEl||(e.stopPropagation(),this.updateListItems())}handleCalciteInternalListItemGroupDefaultSlotChange(e){e.stopPropagation()}connectObserver(){var e;(e=this.mutationObserver)==null||e.observe(this.el,{childList:!0,subtree:!0})}disconnectObserver(){var e;(e=this.mutationObserver)==null||e.disconnect()}setUpSorting(){const{dragEnabled:e}=this;e&&N(this)}onGlobalDragStart(){this.disconnectObserver()}onGlobalDragEnd(){this.connectObserver()}onDragEnd(e){this.calciteListDragEnd.emit(e)}onDragMove({relatedEl:e}){e.expanded=!0}onDragStart(e){e.dragEl.sortHandleOpen=!1,this.calciteListDragStart.emit(e)}onDragSort(e){this.setParentList(),this.updateListItems(),this.calciteListOrderChange.emit(e)}setParentList(){var e;this.parentListEl=(e=this.el.parentElement)==null?void 0:e.closest(v)}handleDefaultSlotChange(e){R(e.target),this.parentListEl&&this.calciteInternalListDefaultSlotChange.emit()}setListItemGroups(){this.listItemGroups=Array.from(this.el.querySelectorAll(F))}handleFilterActionsStartSlotChange(e){this.hasFilterActionsStart=I(e)}handleFilterActionsEndSlotChange(e){this.hasFilterActionsEnd=I(e)}handleFilterNoResultsSlotChange(e){this.hasFilterNoResults=I(e)}setActiveListItem(){const{focusableItems:e}=this;e.some(t=>t.active)||e[0]&&(e[0].active=!0)}async updateSelectedItems(e=!1){await this.updateComplete,this.selectedItems=this.visibleItems.filter(t=>t.selected),e&&this.calciteListChange.emit()}filterElements({el:e,filteredItems:t,visibleParents:i}){const l=!i.has(e)&&!t.includes(e);e.filterHidden=l;const a=e.parentElement.closest(j);a&&(l||i.add(a),this.filterElements({el:a,filteredItems:t,visibleParents:i}))}allParentListItemsExpanded(e){var i;const t=(i=e.parentElement)==null?void 0:i.closest(u);if(t){if(!t.expanded)return!1}else return!0;return this.allParentListItemsExpanded(t)}borderItems(){const e=this.visibleItems.filter(t=>!t.filterHidden&&this.allParentListItemsExpanded(t));e.forEach(t=>t.bordered=t!==e[e.length-1])}updateFilteredItems(){const{visibleItems:e,filteredData:t,filterText:i,filterPredicate:l}=this,a=e==null?void 0:e.filter(r=>e.every(c=>c===r||!r.contains(c))),s=l?e.filter(l):i?t.map(r=>r.el):e||[],o=new WeakSet;a.forEach(r=>this.filterElements({el:r,filteredItems:s,visibleParents:o})),this.filteredItems=s,this.willFilterEmit&&(this.willFilterEmit=!1,this.calciteListFilter.emit())}updateFilteredData(){const{filterEl:e}=this;e&&(e.filteredItems&&(this.filteredData=e.filteredItems),this.updateListItems())}async filterAndUpdateData(){var e;await((e=this.filterEl)==null?void 0:e.filter(this.filterText)),this.updateFilteredData()}get effectiveFilterProps(){return this.filterProps?this.filterProps.filter(e=>e!=="el"):["description","label","metadata","heading"]}performFilter(){const{filterEl:e,filterText:t,effectiveFilterProps:i}=this;e&&(e.value=t,e.filterProps=i,this.filterAndUpdateData())}setFilterEl(e){this.filterEl=e,this.performFilter()}handleFilterChange(e){e.stopPropagation();const{value:t}=e.currentTarget;this.filterText=t,this.willFilterEmit=!0,this.updateFilteredData()}getItemData(){return this.listItems.map(e=>({label:e.label,description:e.description,metadata:e.metadata,heading:this.getGroupHeading(e),el:e}))}getGroupHeading(e){return this.listItemGroups.filter(t=>t.contains(e)).map(t=>t.heading)}updateGroupItems(){const{el:e,group:t,scale:i}=this,l=D(e),a=t?Array.from(l.querySelectorAll(`${v}[group="${t}"]`)).filter(s=>!s.disabled&&s.dragEnabled):[];this.moveToItems=a.map(s=>({element:s,label:s.label??s.id,id:z()})),Array.from(this.el.querySelectorAll(F)).forEach(s=>{s.scale=i})}focusRow(e){const{focusableItems:t}=this;e&&(t.forEach(i=>i.active=i===e),e.setFocus())}isNavigable(e){var i;const t=(i=e.parentElement)==null?void 0:i.closest(u);return t?t.expanded&&this.isNavigable(t):!0}handleListKeydown(e){var a;if(e.defaultPrevented||this.parentListEl)return;const{key:t}=e,i=this.focusableItems.filter(s=>this.isNavigable(s)),l=i.findIndex(s=>s.active);if(t==="ArrowDown"){e.preventDefault();const s=e.target===this.filterEl?0:l+1;i[s]&&this.focusRow(i[s])}else if(t==="ArrowUp"){if(e.preventDefault(),l===0&&this.filterEnabled){(a=this.filterEl)==null||a.setFocus();return}const s=l-1;i[s]&&this.focusRow(i[s])}else if(t==="Home"){e.preventDefault();const s=i[0];s&&this.focusRow(s)}else if(t==="End"){e.preventDefault();const s=i[i.length-1];s&&this.focusRow(s)}}handleInteractionModeWarning(){this.interactionMode==="static"&&this.selectionMode!=="none"&&this.selectionAppearance==="border"&&console.warn('selection-appearance="border" requires interaction-mode="interactive"')}handleMove(e){const{moveTo:t}=e.detail,i=e.target,l=i==null?void 0:i.parentElement,a=t.element,s=Array.from(l.children).filter(E).indexOf(i);if(!l)return;i.sortHandleOpen=!1,this.disconnectObserver(),a.prepend(i),U(i);const o=Array.from(a.children).filter(E).indexOf(i);this.updateListItems(),this.connectObserver(),this.calciteListOrderChange.emit({dragEl:i,fromEl:l,toEl:a,newIndex:o,oldIndex:s})}handleReorder(e){const{reorder:t}=e.detail,i=e.target,l=i==null?void 0:i.parentElement;if(!l)return;i.sortHandleOpen=!1;const a=Array.from(l.children).filter(E),s=a.length-1,o=a.indexOf(i);let r=o;switch(t){case"top":r=0;break;case"bottom":r=s;break;case"up":r=o===0?0:o-1;break;case"down":r=o===s?s:o+1;break}this.disconnectObserver();const c=t==="up"||t==="top"?a[r]:a[r].nextSibling;l.insertBefore(i,c),this.updateListItems(),this.connectObserver(),this.calciteListOrderChange.emit({dragEl:i,fromEl:l,toEl:l,newIndex:r,oldIndex:o})}render(){const{loading:e,label:t,disabled:i,dataForFilter:l,filterEnabled:a,filterPlaceholder:s,filterText:o,filterLabel:r,hasFilterActionsStart:c,hasFilterActionsEnd:f,effectiveFilterProps:n}=this;return T({disabled:this.disabled,children:d`<div class=${h(m.container)}>${this.dragEnabled?d`<span aria-live=assertive class=${h(m.assistiveText)}>${this.assistiveText}</span>`:null}${this.renderItemAriaLive()}${e?d`<calcite-scrim class=${h(m.scrim)} .loading=${e}></calcite-scrim>`:null}<div .ariaBusy=${e} .ariaLabel=${t||""} class=${h(m.table)} @keydown=${this.handleListKeydown} role=treegrid>${a||c||f?d`<div class=${h(m.sticky)} role=rowgroup><div role=row><div role=columnheader><calcite-stack class=${h(m.stack)}><slot name=${L.filterActionsStart} @slotchange=${this.handleFilterActionsStartSlotChange} slot=${C.actionsStart}></slot><calcite-filter .ariaLabel=${s} .disabled=${i} .filterProps=${n} .items=${l} .label=${r} @calciteFilterChange=${this.handleFilterChange} .placeholder=${s} .scale=${this.scale} .value=${o} ${k(this.setFilterEl)}></calcite-filter><slot name=${L.filterActionsEnd} @slotchange=${this.handleFilterActionsEndSlotChange} slot=${C.actionsEnd}></slot></calcite-stack></div></div></div>`:null}<div class=${h(m.tableContainer)} role=rowgroup><slot @slotchange=${this.handleDefaultSlotChange}></slot></div></div><div aria-live=polite data-test-id=no-results-container .hidden=${!this.showNoResultsContainer}><slot name=${L.filterNoResults} @slotchange=${this.handleFilterNoResultsSlotChange}></slot></div></div>`})}renderItemAriaLive(){const{messages:e,filteredItems:t,parentListEl:i,messages:{_lang:l},numberingSystem:a}=this;return x.numberFormatOptions={locale:l,numberingSystem:a},i?null:d`<div aria-live=polite class=${h(m.assistiveText)}>${this.hasActiveFilter?b("aria-filter-enabled",d`<div>${e.filterEnabled}</div>`):null}${b("aria-item-count",d`<div>${e.total.replace("{count}",x.localize(t.length.toString()))}</div>`)}${t.length?b("aria-item-list",d`<ol>${t.map(s=>d`<li>${s.label}</li>`)}</ol>`):null}</div>`}};g.properties={assistiveText:16,dataForFilter:16,hasFilterActionsEnd:16,hasFilterActionsStart:16,hasFilterNoResults:16,moveToItems:16,hasActiveFilter:16,showNoResultsContainer:16,canPull:0,canPut:0,disabled:7,dragEnabled:7,filterEnabled:7,filterPredicate:0,filterLabel:3,filterPlaceholder:3,filterProps:0,filterText:3,filteredData:0,filteredItems:0,group:3,interactionMode:3,label:1,loading:7,messageOverrides:0,displayMode:3,numberingSystem:1,scale:3,selectedItems:0,selectionAppearance:3,selectionMode:3},g.styles=K;let S=g;w("calcite-list",S);export{S as List};
