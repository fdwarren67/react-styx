import{e as k,M as E,f as p,i as n,x as m,j as x,S as B}from"./index-5Uv45sI4.js";import{m as O,p as I}from"./interactive-BKbZm5P7.js";import{b as S}from"./observers-CKvzzITU.js";import{D as C,I as y}from"./sortableComponent-DcctxQH5.js";import{m as G}from"./component-Dxbaltlt.js";import{a as $,p as T}from"./dom-DJEv2Q-P.js";import{i as w}from"./guid-BDWAkmkV.js";import{d as D}from"./debounce-DbkufipY.js";import"./logger-CuHV5ymd.js";/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.1.0 */function u(h){return h.tagName==="CALCITE-BLOCK"}const c={container:"container",groupContainer:"group-container",scrim:"scrim",assistiveText:"assistive-text"},b="calcite-block-group",g="calcite-block",A=x`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block}.container{position:relative}.assistive-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}`;function M(h){const e=h.assignedElements({flatten:!0}).filter(s=>s.matches(g));e.forEach(s=>{s.setPosition=e.indexOf(s)+1,s.setSize=e.length})}const d=class d extends k{constructor(){super(),this.dragSelector=g,this.handleSelector="calcite-sort-handle",this.mutationObserver=S("mutation",()=>{this.updateBlockItems()}),this.updateBlockItems=D(()=>{this.updateGroupItems();const{dragEnabled:e,el:s,moveToItems:t}=this;Array.from(this.el.querySelectorAll(g)).forEach(i=>{i.closest(b)===s&&(i.moveToItems=t.filter(a=>a.element!==s&&!i.contains(a.element)),i.dragHandle=e)}),this.setUpSorting()},E.nextTick),this.moveToItems=[],this.disabled=!1,this.dragEnabled=!1,this.loading=!1,this.calciteBlockGroupDragEnd=p({cancelable:!1}),this.calciteBlockGroupDragStart=p({cancelable:!1}),this.calciteBlockGroupOrderChange=p({cancelable:!1}),this.listen("calciteInternalAssistiveTextChange",this.handleCalciteInternalAssistiveTextChange),this.listen("calciteSortHandleReorder",this.handleSortReorder),this.listen("calciteSortHandleMove",this.handleSortMove)}async setFocus(){await G(this),$(this.el)}connectedCallback(){super.connectedCallback(),this.connectObserver(),this.updateBlockItems(),this.setUpSorting(),this.setParentBlockGroup()}willUpdate(e){(e.has("group")||e.has("dragEnabled")&&(this.hasUpdated||this.dragEnabled!==!1))&&this.updateBlockItems()}updated(){O(this)}disconnectedCallback(){super.disconnectedCallback(),this.disconnectObserver(),C(this)}updateGroupItems(){const{el:e,group:s}=this,t=T(e),i=s?Array.from(t.querySelectorAll(`${b}[group="${s}"]`)).filter(a=>!a.disabled&&a.dragEnabled):[];this.moveToItems=i.map(a=>({element:a,label:a.label??a.id,id:w()}))}handleCalciteInternalAssistiveTextChange(e){this.assistiveText=e.detail.message,e.stopPropagation()}handleSortReorder(e){this.parentBlockGroupEl||this.handleReorder(e)}handleSortMove(e){this.parentBlockGroupEl||this.handleMove(e)}connectObserver(){var e;(e=this.mutationObserver)==null||e.observe(this.el,{childList:!0,subtree:!0})}disconnectObserver(){var e;(e=this.mutationObserver)==null||e.disconnect()}setUpSorting(){const{dragEnabled:e}=this;e&&y(this)}onGlobalDragStart(){this.disconnectObserver()}onGlobalDragEnd(){this.connectObserver()}onDragEnd(e){this.calciteBlockGroupDragEnd.emit(e)}onDragStart(e){e.dragEl.sortHandleOpen=!1,this.calciteBlockGroupDragStart.emit(e)}onDragSort(e){this.setParentBlockGroup(),this.updateBlockItems(),this.calciteBlockGroupOrderChange.emit(e)}setParentBlockGroup(){var e;this.parentBlockGroupEl=(e=this.el.parentElement)==null?void 0:e.closest(b)}handleDefaultSlotChange(e){M(e.target)}handleMove(e){const{moveTo:s}=e.detail,t=e.target,i=t==null?void 0:t.parentElement,a=s.element,l=Array.from(i.children).filter(u).indexOf(t);if(!i)return;t.sortHandleOpen=!1,this.disconnectObserver(),a.prepend(t);const r=Array.from(a.children).filter(u).indexOf(t);this.updateBlockItems(),this.connectObserver(),this.calciteBlockGroupOrderChange.emit({dragEl:t,fromEl:i,toEl:a,newIndex:r,oldIndex:l})}handleReorder(e){const{reorder:s}=e.detail,t=e.target,i=t==null?void 0:t.parentElement;if(!i)return;t.sortHandleOpen=!1;const a=Array.from(i.children).filter(u),l=a.length-1,r=a.indexOf(t);let o=r;switch(s){case"top":o=0;break;case"bottom":o=l;break;case"up":o=r===0?0:r-1;break;case"down":o=r===l?l:r+1;break}this.disconnectObserver();const v=s==="up"||s==="top"?a[o]:a[o].nextSibling;i.insertBefore(t,v),this.updateBlockItems(),this.connectObserver(),this.calciteBlockGroupOrderChange.emit({dragEl:t,fromEl:i,toEl:i,newIndex:o,oldIndex:r})}render(){const{loading:e,label:s}=this;return I({disabled:this.disabled,children:m`<div class=${n(c.container)}>${this.dragEnabled?m`<span aria-live=assertive class=${n(c.assistiveText)}>${this.assistiveText}</span>`:null}${e?m`<calcite-scrim class=${n(c.scrim)} .loading=${e}></calcite-scrim>`:null}<div .ariaBusy=${e} .ariaLabel=${s||""} class=${n(c.groupContainer)} role=group><slot @slotchange=${this.handleDefaultSlotChange}></slot></div></div>`})}};d.properties={assistiveText:16,moveToItems:16,canPull:0,canPut:0,disabled:7,dragEnabled:7,group:3,label:1,loading:7},d.styles=A;let f=d;B("calcite-block-group",f);export{f as BlockGroup};
