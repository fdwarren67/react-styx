{
  "version": 3,
  "sources": ["../../@arcgis/core/views/interactive/snapping/GridSnappingEngine.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Accessor.js\";import r from\"../../../core/Logger.js\";import{deg2rad as i}from\"../../../core/mathUtils.js\";import{convertUnit as n}from\"../../../core/unitUtils.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import{L as a}from\"../../../chunks/vec32.js\";import{isLoadedOrLoadFor as p,project as l}from\"../../../geometry/projection.js\";import{getClosestDenormalizedXToReference as c}from\"../../../geometry/support/normalizeUtils.js\";import{getResolutionForScale as u}from\"../../../geometry/support/scaleUtils.js\";import{minimumPixelsPerStrideForDisplayWhenScalingOff as d}from\"../../2d/grid/constants.js\";import{getScaleFactor as g,measureMetersPerUnitAtReferencePoint as f}from\"../../2d/grid/gridUtils.js\";import{create as h,createWritable as m}from\"../sketch/normalizedPoint.js\";import{gridPlacementGraphicSymbol as S}from\"./snappingUtils.js\";import{IntersectionSnappingCandidate as y}from\"./candidates/IntersectionSnappingCandidate.js\";import{LineSnappingCandidate as v}from\"./candidates/LineSnappingCandidate.js\";let w=class extends t{constructor(e){super(e),this.options=null}destroy(){this._set(\"options\",null)}get grid(){return this.view.grid}get effectiveViewRotation(){return this.grid?.rotateWithMap?0:i(this.view.rotation??0)}get gridRotation(){return i(this.grid?.rotation??0)}get gridCenter(){const{spatialReference:e,grid:t}=this;if(!t||!e||!p(t.center.spatialReference,e))return null;try{const r=l(t.center,e),i=e.isWrappable&&null!=this.view?.center?c(r.x,this.view.center.x,e):r.x;return h(i,r.y,r.z)}catch(i){return r.getLogger(this).errorOnce(\"Grid Snapping - Failed to project grid center.\",i),null}}get offsetScaleFactor(){const{pixelsPerStride:e,grid:t}=this;if(!t||!e)return 1;const{majorLineInterval:r,dynamicScaling:i}=t;return r<1?null:g(r,e,i)}get spatialReference(){return this.view.spatialReference}get gridMetersPerStride(){const{grid:e}=this;return e?n(e.spacing,e.units,\"meters\"):null}get viewMetersPerPixel(){const{viewMetersPerSRUnit:e}=this;return null==e?null:e*u(this.view.scale,this.view.spatialReference)}get viewMetersPerSRUnit(){const{spatialReference:e}=this.view;return this.gridCenter?f(this.gridCenter[0],this.gridCenter[1],e):null}get pixelsPerStride(){const{gridMetersPerStride:e,viewMetersPerPixel:t}=this;return t&&e?e/t:null}get updating(){return null!=this.grid&&null!=this.spatialReference&&null==this.viewMetersPerSRUnit}async fetchCandidates(e,t,r){const{options:i,view:n}=this;if(!i?.effectiveGridEnabled||!n.grid||r.feature?.attributes&&S in r.feature.attributes)return[];const o=r.coordinateHelper.arrayToPoint(e),s=i.distance*(\"touch\"===r.pointer?i.touchSensitivityMultiplier:1);return this.fetchCandidatesSync(o,s)}fetchCandidatesSync(e,t){const r=[],{grid:i,effectiveViewRotation:n,gridRotation:o,gridCenter:s,viewMetersPerPixel:a,viewMetersPerSRUnit:c,offsetScaleFactor:u,spatialReference:g,gridMetersPerStride:f,pixelsPerStride:m}=this;if(!(i&&a&&c&&s&&g&&u&&f&&m))return r;if(!i.dynamicScaling&&m<d)return r;if(!p(e.spatialReference,g))return r;const S=l(e,g),w=h(S.x,S.y,S.z),x=P(w,-o,s,-n),C=f/c*u,U=j(x,C,s),{shouldSnapX:b,shouldSnapY:L}=R(U,x,t,a,c);if(!b&&!L)return[];const z=h((b?U:x)[0],(L?U:x)[1]),E=P(z,o,s,n),F=P(U,o,s,n);if(L){const e=M(U,x,C,\"y\"),t=P(e,o,s,n);r.push(new v({lineStart:F,lineEnd:t,targetPoint:E,isDraped:!1}))}if(b){const e=M(U,x,C,\"x\"),t=P(e,o,s,n);r.push(new v({lineStart:F,lineEnd:t,targetPoint:E,isDraped:!1}))}return b&&L&&r.push(new y(E,r[0],r[1],!1)),r}};e([o({constructOnly:!0})],w.prototype,\"view\",void 0),e([o()],w.prototype,\"options\",void 0),e([o()],w.prototype,\"grid\",null),e([o()],w.prototype,\"effectiveViewRotation\",null),e([o()],w.prototype,\"gridRotation\",null),e([o()],w.prototype,\"gridCenter\",null),e([o()],w.prototype,\"offsetScaleFactor\",null),e([o()],w.prototype,\"spatialReference\",null),e([o()],w.prototype,\"gridMetersPerStride\",null),e([o()],w.prototype,\"viewMetersPerPixel\",null),e([o()],w.prototype,\"viewMetersPerSRUnit\",null),e([o()],w.prototype,\"pixelsPerStride\",null),e([o()],w.prototype,\"updating\",null),w=e([s(\"esri.views.interactive.snapping.GridSnappingEngine\")],w);const P=(e,t,r,i)=>{const n=m(e[0],e[1],e[2]);return a(n,a(n,n,r,t),r,i)},j=(e,t,r)=>{const i=(e[0]-r[0])/t,n=(e[1]-r[1])/t,o=Math.trunc(i),s=Math.trunc(n),a=Math.round(i%1),p=Math.round(n%1),l=r[0]+(o+a)*t,c=r[1]+(s+p)*t;return h(l,c)},R=(e,t,r,i,n)=>{if(i<=0)return{shouldSnapX:!1,shouldSnapY:!1};const o=(e[0]-t[0])/i,s=(e[1]-t[1])/i;return{shouldSnapX:Math.abs(o*n)<r,shouldSnapY:Math.abs(s*n)<r}},M=(e,t,r,i)=>{if(\"y\"===i){const i=t[0]>e[0]?1:-1;return h(e[0]+r*i,e[1])}const n=t[1]>e[1]?1:-1;return h(e[0],e[1]+r*n)};export{w as GridSnappingEngine};\n"],
  "mappings": "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",
  "names": ["w", "t", "r", "u", "n", "s", "a", "c", "g", "f", "m", "x", "P", "U", "e", "l", "i"]
}
