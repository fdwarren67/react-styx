import {
  d as d2,
  d2 as d3,
  f
} from "./chunk-UYMOCXJC.js";
import {
  A,
  O as O3,
  T,
  _ as _2,
  c,
  f as f2,
  g as g5,
  h as h4,
  l as l2,
  m as m2,
  p as p5
} from "./chunk-6ODE2WLX.js";
import {
  n as n4
} from "./chunk-25NL5TAZ.js";
import {
  i as i5
} from "./chunk-TYPEWHVW.js";
import {
  i as i3
} from "./chunk-4YDWJUBU.js";
import {
  i as i4
} from "./chunk-YISRE3T5.js";
import {
  r as r5,
  t as t4
} from "./chunk-DTPSE2SE.js";
import {
  S as S2,
  a as a4
} from "./chunk-6ODLL4CO.js";
import {
  y
} from "./chunk-ZMZA5FVA.js";
import {
  e as e2
} from "./chunk-IZJLQDI2.js";
import {
  x
} from "./chunk-GGSQ5AVK.js";
import "./chunk-AWVDCINM.js";
import {
  a as a3,
  g as g4,
  i as i2,
  u as u2
} from "./chunk-WZ5XGARC.js";
import {
  V,
  n as n3,
  o2,
  t as t2
} from "./chunk-AAIKSZFL.js";
import {
  p as p3
} from "./chunk-IVPVPFYU.js";
import "./chunk-NJX7X3PO.js";
import {
  O as O2,
  _,
  he,
  te,
  xe
} from "./chunk-FQS6ZZHL.js";
import {
  S,
  g as g3
} from "./chunk-6QH5QYZM.js";
import "./chunk-MAX4GY2G.js";
import "./chunk-J2QYVOHP.js";
import "./chunk-NBFYN6KG.js";
import "./chunk-3YC3Z7OQ.js";
import "./chunk-T5R43RTD.js";
import "./chunk-CCPDXL7V.js";
import "./chunk-OK5AUMBT.js";
import "./chunk-R2ZUOHHV.js";
import "./chunk-OBVDE24U.js";
import "./chunk-6PQMUQJV.js";
import "./chunk-JDUGBJ57.js";
import "./chunk-3HA4XA2C.js";
import "./chunk-H2OC77GP.js";
import "./chunk-RDHJUEBL.js";
import "./chunk-DGDYI2GQ.js";
import "./chunk-PJIFP7OJ.js";
import "./chunk-NPEU24W6.js";
import "./chunk-I75Q3UU4.js";
import {
  E,
  e,
  p2 as p4
} from "./chunk-TOU5KPOG.js";
import {
  mt
} from "./chunk-6D65DCMG.js";
import "./chunk-GTVVYAXM.js";
import {
  t as t3
} from "./chunk-AU4QUDF3.js";
import "./chunk-XOXXDYBM.js";
import "./chunk-5BSH2ZN2.js";
import {
  p as p2,
  w as w2
} from "./chunk-HQ2GCCLQ.js";
import {
  p,
  r as r4
} from "./chunk-74GH4Z6V.js";
import {
  h as h3
} from "./chunk-PXBFVQ6M.js";
import "./chunk-TYJV2BHR.js";
import "./chunk-I6H2R562.js";
import "./chunk-WMLTK6KE.js";
import {
  t
} from "./chunk-SURICA27.js";
import "./chunk-PBHST2SF.js";
import {
  a as a2
} from "./chunk-PONPGREB.js";
import {
  D,
  L,
  O,
  P as P2,
  R,
  U
} from "./chunk-QNYMCEB7.js";
import {
  l
} from "./chunk-T7CHWWE2.js";
import {
  M,
  b as b2,
  h,
  i,
  o,
  r as r3
} from "./chunk-FWVSIQMR.js";
import "./chunk-4ACM2XXN.js";
import "./chunk-ON7GWFUW.js";
import {
  h as h2
} from "./chunk-VPRLLNNO.js";
import {
  g as g2
} from "./chunk-64ZXKK6G.js";
import "./chunk-UCM2ZG62.js";
import "./chunk-VT63JL2L.js";
import "./chunk-WJNJ43ZU.js";
import "./chunk-MIW7M4LL.js";
import "./chunk-6W3XFTHW.js";
import {
  z
} from "./chunk-Q44EAKHA.js";
import "./chunk-4HTLBMKF.js";
import "./chunk-YUQ6PSJ2.js";
import "./chunk-SB6LU3VH.js";
import "./chunk-OQEC2EUK.js";
import "./chunk-GPMU6IW4.js";
import "./chunk-4JHPTLMD.js";
import "./chunk-35I4PBUK.js";
import "./chunk-ZQMORW2K.js";
import "./chunk-OGPRAWXS.js";
import "./chunk-EGSJQZXU.js";
import "./chunk-7VGCZZPH.js";
import "./chunk-C33DSFWF.js";
import "./chunk-LILYILCM.js";
import "./chunk-WBBL3X3F.js";
import "./chunk-OJGPUKVG.js";
import "./chunk-GFEMKR2U.js";
import "./chunk-G2OXL5Y3.js";
import {
  b as b3
} from "./chunk-BLF64HON.js";
import "./chunk-I3JB2EVB.js";
import "./chunk-TCV7UF6X.js";
import "./chunk-BMNRD4FO.js";
import "./chunk-W7QCICS6.js";
import "./chunk-AYLNWVVJ.js";
import "./chunk-PQVKYMOX.js";
import "./chunk-DCSYHXZG.js";
import "./chunk-ZSBMFGDQ.js";
import "./chunk-NAGFHISJ.js";
import "./chunk-QCS4ZI2R.js";
import "./chunk-2SOWSOAE.js";
import "./chunk-KSQSVLSQ.js";
import "./chunk-SPVEONZ2.js";
import "./chunk-BMNDO4JW.js";
import "./chunk-RAVPBO4Z.js";
import "./chunk-PHADC6NW.js";
import "./chunk-3ODJ3YKN.js";
import "./chunk-P6IUM5K3.js";
import "./chunk-KGTLNUPW.js";
import "./chunk-GY7XU54K.js";
import "./chunk-P4D4HTH2.js";
import "./chunk-GDR4JYWU.js";
import "./chunk-Y4AQXF4J.js";
import "./chunk-D3P3E2RE.js";
import {
  C,
  P,
  d
} from "./chunk-UKY33OJN.js";
import "./chunk-HAWCNM3C.js";
import "./chunk-BQYXRSVC.js";
import "./chunk-BJEQ2APY.js";
import "./chunk-WKNMEFRQ.js";
import "./chunk-Q7TEBZSN.js";
import "./chunk-CIALVDRG.js";
import "./chunk-N5E3DEQN.js";
import "./chunk-GTN3PVPB.js";
import "./chunk-BF5PIC2K.js";
import "./chunk-K7TZXQ7O.js";
import "./chunk-FZPO5AYT.js";
import "./chunk-5VM3BO4P.js";
import "./chunk-EYUJRAXJ.js";
import "./chunk-BDOGPNOY.js";
import "./chunk-552ZCNNH.js";
import "./chunk-XG7T2Y7N.js";
import "./chunk-SQOMDKJS.js";
import "./chunk-HB6TKF6E.js";
import {
  u
} from "./chunk-OXPM753Y.js";
import {
  w
} from "./chunk-N4U5VIP2.js";
import {
  j2 as j
} from "./chunk-IVS2JCO6.js";
import "./chunk-4GOW35CM.js";
import "./chunk-TEJXT4W6.js";
import "./chunk-LW62SPEN.js";
import "./chunk-LSOJIRW6.js";
import "./chunk-FSFEOCO5.js";
import "./chunk-ZVIMKAJW.js";
import "./chunk-BIURGGHV.js";
import "./chunk-VSLEAHOZ.js";
import "./chunk-6K2FAOQG.js";
import "./chunk-N5DN7S3H.js";
import "./chunk-BECTSF5P.js";
import "./chunk-FX46DC27.js";
import "./chunk-2FUEBHWI.js";
import {
  g,
  m
} from "./chunk-VTWDBFQT.js";
import {
  a2 as a
} from "./chunk-BM4B3CH5.js";
import "./chunk-G2YC5GCV.js";
import "./chunk-GD5AHXAI.js";
import "./chunk-YWGYHRSH.js";
import "./chunk-DP2IAJQN.js";
import "./chunk-EAFC6V23.js";
import {
  b,
  k,
  n as n2,
  r as r2
} from "./chunk-SMH2GUF6.js";
import "./chunk-AZP4AFW7.js";
import {
  r
} from "./chunk-SCZRL2WP.js";
import {
  s
} from "./chunk-OSHCNHH7.js";
import "./chunk-7LCEUMDD.js";
import {
  n2 as n
} from "./chunk-6II7WQ2F.js";
import "./chunk-L7QO6TDW.js";
import "./chunk-EWTE5DHJ.js";

// node_modules/@arcgis/core/views/2d/engine/imagery/RasterBitmap.js
var c2 = { bandCount: 3, minOutput: 0, maxOutput: 1, minCutOff: [0, 0, 0], maxCutOff: [255, 255, 255], factor: [1 / 255, 1 / 255, 1 / 255], useGamma: false, gamma: [1, 1, 1], gammaCorrection: [1, 1, 1], colormap: null, colormapOffset: null, stretchType: "none", type: "stretch" };
var _3 = class extends e2 {
  constructor(e17 = null, t6 = null, s19 = null) {
    super(), this._textureInvalidated = true, this._colormapTextureInvalidated = true, this._rasterTexture = null, this._rasterTextureBandIds = null, this._transformGridTexture = null, this._colormapTexture = null, this._colormap = null, this._supportsBilinearTexture = true, this._processedTexture = null, this.functionTextures = [], this.projected = false, this.stencilRef = 0, this.coordScale = [1, 1], this._processed = false, this._symbolizerParameters = null, this.height = null, this.isRendereredSource = false, this.pixelRatio = 1, this.resolution = 0, this.rotation = 0, this._source = null, this.rawPixelData = null, this._suspended = false, this._bandIds = null, this._interpolation = null, this._transformGrid = null, this.width = null, this.x = 0, this.y = 0, this.source = e17, this.transformGrid = t6, this.interpolation = s19;
  }
  destroy() {
    this._disposeTextures();
  }
  get processedTexture() {
    return this._processedTexture;
  }
  set processedTexture(e17) {
    this._processedTexture !== e17 && (this._disposeTextures(true), this._processedTexture = e17);
  }
  get rasterTexture() {
    return this._rasterTexture;
  }
  set rasterTexture(e17) {
    var _a;
    this._rasterTexture !== e17 && ((_a = this._rasterTexture) == null ? void 0 : _a.dispose(), this._rasterTexture = e17), null == e17 && (this.projected = false);
  }
  get processed() {
    return this._processed;
  }
  set processed(t6) {
    this._processed = t6, t6 || (r2(this.processedTexture), this.invalidateTexture());
  }
  get symbolizerParameters() {
    return this._symbolizerParameters || c2;
  }
  set symbolizerParameters(e17) {
    this._symbolizerParameters !== e17 && (this._symbolizerParameters = e17, this._colormapTextureInvalidated = true, this.commonUniforms = null);
  }
  get source() {
    return this._source;
  }
  set source(e17) {
    this._source !== e17 && (this._source = e17, this._rasterTexture && (this._rasterTexture.dispose(), this._rasterTexture = null, this._rasterTextureBandIds = null), this.commonUniforms = null, this.projected = false, this.invalidateTexture());
  }
  get suspended() {
    return this._suspended;
  }
  set suspended(e17) {
    this._suspended && !e17 && this.stage && (this.ready(), this.requestRender()), this._suspended = e17;
  }
  get bandIds() {
    return this._bandIds;
  }
  set bandIds(e17) {
    this._bandIds = e17, this._isBandIdsChanged(e17) && (this.projected = false, this.invalidateTexture());
  }
  get interpolation() {
    return this._interpolation || "nearest";
  }
  set interpolation(e17) {
    this._interpolation = e17, this._rasterTexture && this._rasterTexture.setSamplingMode("bilinear" === this._getTextureSamplingMethod(e17 || "nearest") ? L.LINEAR : L.NEAREST);
  }
  get transformGrid() {
    return this._transformGrid;
  }
  set transformGrid(t6) {
    this._transformGrid !== t6 && (this._transformGrid = t6, this._transformGridTexture = r2(this._transformGridTexture));
  }
  invalidateTexture() {
    this._textureInvalidated || (this._textureInvalidated = true, this.requestRender());
  }
  getRasterTextureSize(e17 = false) {
    var _a, _b;
    const t6 = e17 || this.projected;
    return [t6 ? this.width : ((_a = this.source) == null ? void 0 : _a.width) || this.width, t6 ? this.height : ((_b = this.source) == null ? void 0 : _b.height) || this.height];
  }
  getRasterCellSize() {
    var _a;
    const e17 = (_a = this.rawPixelData) == null ? void 0 : _a.srcPixelSize, { projected: t6, resolution: s19 } = this;
    return e17 && !t6 ? [e17.x, e17.y] : [s19, s19];
  }
  _createTransforms() {
    return { displayViewScreenMat3: e() };
  }
  setTransform(e17) {
    const a23 = o(this.transforms.displayViewScreenMat3), [h6, n26] = e17.toScreenNoRotation([0, 0], [this.x, this.y]), l4 = this.resolution / this.pixelRatio / e17.resolution, d4 = l4 * this.width, p6 = l4 * this.height, c5 = Math.PI * this.rotation / 180;
    M(a23, a23, t(h6, n26)), M(a23, a23, t(d4 / 2, p6 / 2)), h(a23, a23, -c5), M(a23, a23, t(-d4 / 2, -p6 / 2)), b2(a23, a23, t(d4, p6)), i(this.transforms.displayViewScreenMat3, e17.displayViewMat3, a23);
  }
  getTextures({ forProcessing: e17 = false, useProcessedTexture: t6 = false } = {}) {
    const s19 = t6 ? this._processedTexture ?? this._rasterTexture : this._rasterTexture, r16 = [], i13 = [];
    return s19 ? (this._transformGridTexture && !this.projected && (i13.push(this._transformGridTexture), r16.push("u_transformGrid")), t6 ? (i13.push(s19), r16.push("u_image"), this._colormapTexture && (i13.push(this._colormapTexture), r16.push("u_colormap")), { names: r16, textures: i13 }) : (i13.push(s19), r16.push("u_image"), this._colormapTexture && !e17 && (i13.push(this._colormapTexture), r16.push("u_colormap")), { names: r16, textures: i13 })) : { names: r16, textures: i13 };
  }
  onAttach() {
    this.invalidateTexture();
  }
  onDetach() {
    this.invalidateTexture();
  }
  updateTexture({ context: e17 }) {
    if (!this.stage) return void this._disposeTextures();
    const t6 = this._isValidSource(this.source);
    t6 && this._colormapTextureInvalidated && (this._colormapTextureInvalidated = false, this._updateColormapTexture(e17)), this._textureInvalidated && (this._textureInvalidated = false, this._createOrDestroyRasterTexture(e17), this._rasterTexture && (t6 ? this.transformGrid && !this._transformGridTexture && (this._transformGridTexture = m2(e17, this.transformGrid)) : this._rasterTexture.setData(null)), this.suspended || (this.ready(), this.requestRender()));
  }
  updateProcessedTexture() {
    const { functionTextures: e17 } = this;
    0 !== e17.length && (this.processedTexture = e17.shift(), e17.forEach((e18) => e18 == null ? void 0 : e18.dispose()), e17.length = 0);
  }
  _createOrDestroyRasterTexture(e17) {
    var _a;
    const t6 = (_a = this.source) == null ? void 0 : _a.extractBands(this.bandIds);
    if (!this._isValidSource(t6)) return void (this._rasterTexture && (this._rasterTexture.dispose(), this._rasterTextureBandIds = null, this._rasterTexture = null));
    const s19 = !this._isBandIdsChanged(this.bandIds);
    if (this._rasterTexture) {
      if (s19) return;
      this._rasterTexture.dispose(), this._rasterTextureBandIds = null, this._rasterTexture = null;
    }
    this._supportsBilinearTexture = !!e17.capabilities.textureFloatLinear;
    const r16 = this._getTextureSamplingMethod(this.interpolation), i13 = this.isRendereredSource;
    this._rasterTexture = f2(e17, t6, r16, i13), this.projected = false, this._processed = false, this._rasterTextureBandIds = this.bandIds ? [...this.bandIds] : null;
  }
  _isBandIdsChanged(e17) {
    const t6 = this._rasterTextureBandIds;
    return !(null == t6 && null == e17 || t6 && e17 && t6.join("") === e17.join(""));
  }
  _isValidSource(e17) {
    var _a;
    return null != e17 && ((_a = e17.pixels) == null ? void 0 : _a.length) > 0;
  }
  _getTextureSamplingMethod(e17) {
    const { type: t6 } = this.symbolizerParameters, s19 = "lut" === t6 && !this.symbolizerParameters.isClassBreaks || "hillshade" === t6 || "stretch" === t6 && 1 === this.symbolizerParameters.bandCount;
    return !this._supportsBilinearTexture || s19 || "bilinear" !== e17 && "cubic" !== e17 ? "nearest" : "bilinear";
  }
  _updateColormapTexture(e17) {
    const t6 = this._colormap, s19 = this.symbolizerParameters.colormap;
    return s19 ? t6 ? s19.length !== t6.length || s19.some((e18, s20) => e18 !== t6[s20]) ? (this._colormapTexture && (this._colormapTexture.dispose(), this._colormapTexture = null), this._colormapTexture = c(e17, s19), void (this._colormap = s19)) : void 0 : (this._colormapTexture = c(e17, s19), void (this._colormap = s19)) : (this._colormapTexture && (this._colormapTexture.dispose(), this._colormapTexture = null), void (this._colormap = null));
  }
  _disposeTextures(e17 = false) {
    !this._transformGridTexture || e17 && !this.projected || (this._transformGridTexture.dispose(), this._transformGridTexture = null), !e17 && this._colormapTexture && (this._colormapTexture.dispose(), this._colormapTexture = null, this._colormap = null, this._colormapTextureInvalidated = true), !e17 && this._rasterTexture && (this._rasterTexture.dispose(), this._rasterTexture = null, this._rasterTextureBandIds = null), this._processedTexture && (this._processedTexture.dispose(), this._processedTexture = null);
  }
};
function m3(e17) {
  return null != e17.source;
}

// node_modules/@arcgis/core/views/2d/engine/imagery/colorizer/utils.js
function i6(i13) {
  const n26 = [];
  return i13 && (n26.push("applyProjection"), 1 === i13.spacing[0] && n26.push("lookupProjection")), n26;
}
function n5(i13, n26, e17) {
  const u4 = !e17.capabilities.textureFloatLinear, t6 = [];
  return "cubic" === i13 ? t6.push("bicubic") : "bilinear" === i13 && (n26 ? (t6.push("bilinear"), t6.push("nnedge")) : u4 && t6.push("bilinear")), t6;
}

// node_modules/@arcgis/core/views/2d/engine/imagery/colorizer/lut.js
var s2 = { vsPath: "raster/common", fsPath: "raster/lut", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function a5(t6, e17, o13) {
  const a23 = o13 ? [] : i6(e17.transformGrid);
  return { defines: a23, program: t6.painter.materialManager.getProgram(s2, a23) };
}
function n6(r16, s19, a23, n26, m7 = false) {
  const { names: i13, textures: c5 } = a23.getTextures({ useProcessedTexture: m7 });
  h4(r16.context, s19, i13, c5), O3(s19, n26, a23.commonUniforms), s19.setUniformMatrix3fv("u_dvsMat3", a23.transforms.displayViewScreenMat3);
  const { colormap: f3, colormapOffset: u4 } = a23.symbolizerParameters, l4 = _2(f3, u4);
  O3(s19, n26, l4);
}
var m4 = { createProgram: a5, bindTextureAndUniforms: n6 };

// node_modules/@arcgis/core/views/2d/engine/imagery/colorizer/shadedrelief.js
var n7 = { vsPath: "raster/common", fsPath: "raster/hillshade", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function i7(e17, o13, s19) {
  const { colormap: a23 } = o13.symbolizerParameters, i13 = [...s19 ? [] : i6(o13.transformGrid), ...n5(o13.interpolation, true, e17.context)];
  null != a23 && i13.push("applyColormap");
  return { defines: i13, program: e17.painter.materialManager.getProgram(n7, i13) };
}
function m5(r16, t6, n26, i13, m7 = false) {
  const { names: c5, textures: l4 } = n26.getTextures({ useProcessedTexture: m7 });
  h4(r16.context, t6, c5, l4), O3(t6, i13, n26.commonUniforms), t6.setUniformMatrix3fv("u_dvsMat3", n26.transforms.displayViewScreenMat3);
  const f3 = n26.symbolizerParameters, { colormap: p6, colormapOffset: u4 } = f3;
  if (null != p6) {
    const r17 = _2(p6, u4);
    O3(t6, i13, r17);
  }
  const d4 = A(f3);
  O3(t6, i13, { ...d4, u_scaling: 1 });
}
var c3 = { createProgram: i7, bindTextureAndUniforms: m5 };

// node_modules/@arcgis/core/views/2d/engine/imagery/colorizer/stretch.js
var n8 = { vsPath: "raster/common", fsPath: "raster/stretch", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function i8(e17, o13, s19) {
  const { colormap: a23, bandCount: i13 } = o13.symbolizerParameters, m7 = [...s19 ? [] : i6(o13.transformGrid), ...n5(o13.interpolation, 1 === i13, e17.context)];
  o13.isRendereredSource && !s19 ? m7.push("noop") : null != a23 && m7.push("applyColormap");
  return { defines: m7, program: e17.painter.materialManager.getProgram(n8, m7) };
}
function m6(r16, t6, n26, i13, m7 = false) {
  const { names: c5, textures: l4 } = n26.getTextures({ useProcessedTexture: m7 });
  h4(r16.context, t6, c5, l4), O3(t6, i13, n26.commonUniforms), t6.setUniformMatrix3fv("u_dvsMat3", n26.transforms.displayViewScreenMat3);
  const p6 = n26.symbolizerParameters, { colormap: u4, colormapOffset: f3 } = p6;
  if (null != u4) {
    const r17 = _2(u4, f3);
    O3(t6, i13, r17);
  }
  const d4 = p5(p6);
  O3(t6, i13, d4);
}
var c4 = { createProgram: i8, bindTextureAndUniforms: m6 };

// node_modules/@arcgis/core/views/2d/engine/imagery/colorizer/rasterColorizer.js
var s3 = /* @__PURE__ */ new Map();
function o3(t6) {
  return s3.get(t6);
}
s3.set("lut", m4), s3.set("hillshade", c3), s3.set("stretch", c4);

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/utils.js
var n9 = [1, 1];
var a6 = [2, 0, 0, 0, 2, 0, -1, -1, 0];
function s4(n26, a23, s19, r16) {
  const { context: i13, rasterFunction: o13, hasBranches: f3 } = n26, { raster: u4 } = o13.parameters, m7 = f3 ? (u4 == null ? void 0 : u4.id) ?? -1 : 0, c5 = [s19.functionTextures[m7] ?? s19.rasterTexture], l4 = ["u_image"];
  if (r16) {
    const e17 = c(i13, r16);
    s19.functionTextures[100] = e17, c5.push(e17), l4.push("u_colormap");
  }
  h4(i13, a23, l4, c5);
}
function r6(t6, n26, a23) {
  const { rasters: r16 } = t6.rasterFunction.parameters;
  if (!r16) return;
  if (r16.length < 2) return s4(t6, n26, a23);
  const i13 = r16.filter((t7) => "Constant" !== t7.name).map((t7) => null != t7.id && "Identity" !== t7.name ? a23.functionTextures[t7.id] : a23.rasterTexture);
  if (h4(t6.context, n26, ["u_image", "u_image1", "u_image2"].slice(0, i13.length), i13), i13.length !== r16.length) {
    if (2 === r16.length) {
      const t7 = r16.findIndex((t8) => "Constant" === t8.name), e17 = 0 === t7 ? [0, 1, 0, 1, 0, 0, 0, 0, 0] : [1, 0, 0, 0, 1, 0, 0, 0, 0], { value: a24 } = r16[t7].parameters;
      n26.setUniform1f("u_image1Const", a24), n26.setUniformMatrix3fv("u_imageSwap", e17);
    } else if (3 === r16.length) {
      const t7 = [];
      if (r16.forEach((e17, n27) => "Constant" === e17.name && t7.push(n27)), 1 === t7.length) {
        const { value: e17 } = r16[t7[0]].parameters;
        n26.setUniform1f("u_image1Const", e17);
        const a24 = 0 === t7[0] ? [0, 1, 0, 0, 0, 1, 1, 0, 0] : 1 === t7[0] ? [1, 0, 0, 0, 0, 1, 0, 1, 0] : [1, 0, 0, 0, 1, 0, 0, 0, 1];
        n26.setUniformMatrix3fv("u_imageSwap", a24);
      } else if (2 === t7.length) {
        const { value: e17 } = r16[t7[0]].parameters;
        n26.setUniform1f("u_image1Const", e17);
        const { value: a24 } = r16[t7[1]].parameters;
        n26.setUniform1f("u_image2Const", a24);
        const s19 = r16.findIndex((t8) => "Constant" !== t8.name), i14 = 0 === s19 ? [1, 0, 0, 0, 1, 0, 0, 0, 1] : 1 === s19 ? [0, 1, 0, 1, 0, 0, 0, 0, 1] : [0, 0, 1, 1, 0, 0, 0, 1, 0];
        n26.setUniformMatrix3fv("u_imageSwap", i14);
      }
    }
  }
}
function i9(t6) {
  t6.setUniform2fv("u_coordScale", n9), t6.setUniformMatrix3fv("u_dvsMat3", a6);
}

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/aspectProcessor.js
var r7 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/aspect", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function a7(t6, e17) {
  return t6.painter.materialManager.getProgram(r7, []);
}
function s5(r16, a23, s19) {
  s4(r16, a23, s19), i9(a23);
  const n26 = s19.getRasterTextureSize();
  a23.setUniform2fv("u_srcImageSize", n26);
  const o13 = s19.getRasterCellSize();
  a23.setUniform2fv("u_cellSize", o13);
}
var n10 = { createProgram: a7, bindTextureAndUniforms: s5 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/bandArithmeticProcessor.js
var a8 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/bandarithmetic", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function e3(t6, r16) {
  const { painter: e17, rasterFunction: n26 } = t6, { indexType: s19, isOutputRounded: o13 } = n26.parameters, i13 = [s19];
  return o13 && i13.push("roundOutput"), e17.materialManager.getProgram(a8, i13);
}
function n11(a23, e17, n26) {
  s4(a23, e17, n26), i9(e17);
  const { bandIndexMat3: s19, adjustments: o13 } = a23.rasterFunction.parameters;
  e17.setUniformMatrix3fv("u_bandIndexMat3", s19), e17.setUniform1fv("u_adjustments", o13);
}
var s6 = { createProgram: e3, bindTextureAndUniforms: n11 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/colormapToRGBProcessor.js
var o4 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/colormap2rgb", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function e4(r16) {
  const { painter: t6 } = r16;
  return t6.materialManager.getProgram(o4, []);
}
function a9(o13, e17, a23) {
  const { indexedColormap: n26, offset: s19 } = o13.rasterFunction.parameters;
  s4(o13, e17, a23, n26), i9(e17), e17.setUniform1f("u_colormapOffset", s19), e17.setUniform1f("u_colormapMaxIndex", n26.length / 4 - 1);
}
var n12 = { createProgram: e4, bindTextureAndUniforms: a9 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/compositeBandProcessor.js
var n13 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/compositeband", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function a10(t6, r16) {
  const a23 = t6.rasterFunction.parameters.rasters.filter((t7) => "Constant" === t7.name), e17 = [];
  return a23.length && (e17.push("oneConstant"), 2 === a23.length && e17.push("twoConstant")), t6.painter.materialManager.getProgram(n13, e17);
}
function e5(n26, a23, e17) {
  r6(n26, a23, e17), i9(a23);
}
var s7 = { createProgram: a10, bindTextureAndUniforms: e5 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/computeChangeProcessor.js
var n14 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/computechange", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function r8(t6) {
  const { painter: e17, rasterFunction: r16 } = t6, { method: a23, rasters: s19, isOutputRounded: o13 } = r16.parameters, i13 = [a23.includes("-") ? a23.slice(0, a23.indexOf("-")) : a23];
  return s19.filter((t7) => "Constant" === t7.name).length && i13.push("oneConstant"), o13 && i13.push("roundOutput"), e17.materialManager.getProgram(n14, i13);
}
function a11(n26, r16, a23) {
  r6(n26, r16, a23), i9(r16);
  const { domainRange: s19 } = n26.rasterFunction.parameters;
  r16.setUniform2fv("u_domainRange", s19);
}
var s8 = { createProgram: r8, bindTextureAndUniforms: a11 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/contrastProcessor.js
var s9 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/contrast", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function e6(t6, r16) {
  return t6.painter.materialManager.getProgram(s9, []);
}
function a12(s19, e17, a23) {
  s4(s19, e17, a23), i9(e17);
  const { contrastOffset: n26, brightnessOffset: o13 } = s19.rasterFunction.parameters;
  e17.setUniform1f("u_contrastOffset", n26), e17.setUniform1f("u_brightnessOffset", o13);
}
var n15 = { createProgram: e6, bindTextureAndUniforms: a12 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/convolutionProcessor.js
var t5 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/convolution", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function a13(e17, r16) {
  const { painter: a23, rasterFunction: n26 } = e17, { kernelRows: o13, kernelCols: s19 } = n26.parameters, i13 = [{ name: "rows", value: o13 }, { name: "cols", value: s19 }];
  return a23.materialManager.getProgram(t5, i13);
}
function n16(t6, a23, n26) {
  s4(t6, a23, n26), i9(a23), a23.setUniform2fv("u_srcImageSize", [n26.width, n26.height]);
  const { kernel: o13, clampRange: s19 } = t6.rasterFunction.parameters;
  a23.setUniform1fv("u_kernel", o13), a23.setUniform2fv("u_clampRange", s19);
}
var o5 = { createProgram: a13, bindTextureAndUniforms: n16 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/curvatureProcessor.js
var e7 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/curvature", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function a14(r16, t6) {
  const { painter: a23, rasterFunction: s19 } = r16, { curvatureType: n26 } = s19.parameters, o13 = [n26];
  return a23.materialManager.getProgram(e7, o13);
}
function s10(e17, a23, s19) {
  s4(e17, a23, s19), i9(a23);
  const n26 = s19.getRasterTextureSize();
  a23.setUniform2fv("u_srcImageSize", n26);
  const { zFactor: o13 } = e17.rasterFunction.parameters, i13 = s19.getRasterCellSize();
  a23.setUniform1f("u_zlFactor", 200 * o13 / i13[0] / i13[1]);
}
var n17 = { createProgram: a14, bindTextureAndUniforms: s10 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/extractBandProcessor.js
var a15 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/extractband", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function e8(t6, r16) {
  return t6.painter.materialManager.getProgram(a15, []);
}
function n18(a23, e17, n26) {
  s4(a23, e17, n26), i9(e17);
  const { bandIndexMat3: o13 } = a23.rasterFunction.parameters;
  e17.setUniformMatrix3fv("u_bandIndexMat3", o13);
}
var o6 = { createProgram: e8, bindTextureAndUniforms: n18 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/focalStatisticsProcessor.js
var e9 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/focalstatistics", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function r9(t6, a23) {
  const { painter: r16, rasterFunction: s19 } = t6, { kernelRows: n26, kernelCols: o13, fillNoDataOnly: i13, statisticsType: c5 } = s19.parameters, l4 = [{ name: "rows", value: n26 }, { name: "cols", value: o13 }, c5];
  return i13 && l4.push("fill"), r16.materialManager.getProgram(e9, l4);
}
function s11(e17, r16, s19) {
  s4(e17, r16, s19), i9(r16), r16.setUniform2fv("u_srcImageSize", [s19.width, s19.height]);
  const { clampRange: n26 } = e17.rasterFunction.parameters;
  r16.setUniform2fv("u_clampRange", n26);
}
var n19 = { createProgram: r9, bindTextureAndUniforms: s11 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/grayscaleProcessor.js
var a16 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/grayscale", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function e10(t6, r16) {
  return t6.painter.materialManager.getProgram(a16, []);
}
function s12(a23, e17, s19) {
  s4(a23, e17, s19), i9(e17);
  const { weights: n26 } = a23.rasterFunction.parameters;
  e17.setUniform3fv("u_weights", n26);
}
var n20 = { createProgram: e10, bindTextureAndUniforms: s12 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/hillshadeProcessor.js
var s13 = { vsPath: "raster/rfx/vs", fsPath: "raster/hillshade", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function r10(e17, t6) {
  const { indexedColormap: r16 } = e17.rasterFunction.parameters, o13 = [];
  return (r16 == null ? void 0 : r16.length) && o13.push("applyColormap"), e17.painter.materialManager.getProgram(s13, o13);
}
function o7(s19, r16, o13) {
  const i13 = s19.rasterFunction.parameters, { indexedColormap: n26 } = i13;
  s4(s19, r16, o13, n26), i9(r16);
  const a23 = o13.getRasterTextureSize();
  r16.setUniform2fv("u_srcImageSize", a23);
  const f3 = o13.getRasterCellSize();
  r16.setUniform2fv("u_cellSize", f3);
  const { pixelSizeFactor: m7 } = i13;
  if (0 === m7) r16.setUniform2fv("u_factor", [i13.factor[0] / f3[0], i13.factor[1] / f3[1]]);
  else {
    const { zFactor: e17, pixelSizePower: t6, gcsFactor: s20 } = i13, o14 = f3[0] * s20, n27 = f3[1] * s20, a24 = (e17 + o14 ** t6 * m7) / (8 * o14), c5 = (e17 + n27 ** t6 * m7) / (8 * n27);
    r16.setUniform2fv("u_factor", [a24, c5]);
  }
  r16.setUniform1i("u_hillshadeType", i13.hillshadeType), r16.setUniform1fv("u_sinZcosAs", i13.sinZcosAs), r16.setUniform1fv("u_sinZsinAs", i13.sinZsinAs), r16.setUniform1fv("u_cosZs", i13.cosZs), r16.setUniform1fv("u_weights", i13.weights), r16.setUniform1f("u_opacity", 1), r16.setUniform1i("u_flipY", 0), r16.setUniform1f("u_scaling", 255), r16.setUniform1f("u_minValue", i13.minValue), r16.setUniform1f("u_maxValue", i13.maxValue), n26 && (r16.setUniform1f("u_colormapOffset", i13.offset), r16.setUniform1f("u_colormapMaxIndex", n26.length / 4 - 1));
}
var i10 = { createProgram: r10, bindTextureAndUniforms: o7 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/localProcessor.js
var a17 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/local", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function e11(t6) {
  const { painter: n26, rasterFunction: e17 } = t6, { imageCount: r16, operationName: o13, rasters: s19, isOutputRounded: u4 } = e17.parameters, i13 = [o13.toLowerCase()];
  2 === r16 && i13.push("twoImages");
  const m7 = s19.filter((t7) => "Constant" === t7.name);
  return m7.length && (i13.push("oneConstant"), 2 === m7.length && i13.push("twoConstant")), u4 && i13.push("roundOutput"), n26.materialManager.getProgram(a17, i13);
}
function r11(a23, e17, r16) {
  r6(a23, e17, r16), i9(e17);
  const { domainRange: o13 } = a23.rasterFunction.parameters;
  e17.setUniform2fv("u_domainRange", o13);
}
var o8 = { createProgram: e11, bindTextureAndUniforms: r11 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/maskProcessor.js
var r12 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/mask", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function n21(t6, a23) {
  const { painter: n26, rasterFunction: e17 } = t6, s19 = e17.parameters.bandCount > 1 ? ["multiBand"] : [];
  return n26.materialManager.getProgram(r12, s19);
}
function e12(r16, n26, e17) {
  s4(r16, n26, e17), i9(n26);
  const { includedRanges: s19, noDataValues: o13 } = r16.rasterFunction.parameters;
  n26.setUniform1fv("u_includedRanges", s19), n26.setUniform1fv("u_noDataValues", o13);
}
var s14 = { createProgram: n21, bindTextureAndUniforms: e12 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/ndviProcessor.js
var a18 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/ndvi", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function e13(t6, r16) {
  const { painter: e17, rasterFunction: n26 } = t6, s19 = n26.parameters.scaled ? ["scaled"] : [];
  return e17.materialManager.getProgram(a18, s19);
}
function n22(a23, e17, n26) {
  s4(a23, e17, n26), i9(e17);
  const { bandIndexMat3: s19 } = a23.rasterFunction.parameters;
  e17.setUniformMatrix3fv("u_bandIndexMat3", s19);
}
var s15 = { createProgram: e13, bindTextureAndUniforms: n22 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/remapProcessor.js
var r13 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/remap", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function e14(a23, t6) {
  return a23.painter.materialManager.getProgram(r13, []);
}
function n23(r16, e17, n26) {
  s4(r16, e17, n26), i9(e17);
  const { noDataRanges: s19, rangeMaps: o13, allowUnmatched: f3, clampRange: i13 } = r16.rasterFunction.parameters;
  e17.setUniform1fv("u_noDataRanges", s19), e17.setUniform1fv("u_rangeMaps", o13), e17.setUniform1f("u_unmatchMask", f3 ? 1 : 0), e17.setUniform2fv("u_clampRange", i13);
}
var s16 = { createProgram: e14, bindTextureAndUniforms: n23 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/reprojectProcessor.js
var e15 = { vsPath: "raster/common", fsPath: "raster/reproject", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function i11(r16, t6) {
  var _a;
  const { painter: i13 } = r16, o13 = [], { interpolation: s19, transformGrid: n26 } = t6, a23 = (_a = r16.rasterFunction) == null ? void 0 : _a.parameters;
  return "cubic" === s19 ? o13.push("bicubic") : "bilinear" === s19 && (o13.push("bilinear"), (a23 == null ? void 0 : a23.requireNNEdge) && o13.push("nnedge")), n26 && (o13.push("applyProjection"), 1 === n26.spacing[0] && o13.push("lookupProjection")), i13.materialManager.getProgram(e15, o13);
}
function o9(e17, i13, o13) {
  const { names: s19, textures: n26 } = o13.getTextures({ forProcessing: true });
  h4(e17.context, i13, s19, n26), i13.setUniform1f("u_scale", 1), i13.setUniform2fv("u_offset", [0, 0]), i13.setUniform2fv("u_coordScale", [1, 1]), i13.setUniformMatrix3fv("u_dvsMat3", [2, 0, 0, 0, 2, 0, -1, -1, 0]), i13.setUniform1i("u_flipY", 0), i13.setUniform1f("u_opacity", 1);
  const { width: a23, height: f3, source: c5, transformGrid: m7 } = o13;
  i13.setUniform2fv("u_srcImageSize", [c5.width, c5.height]), i13.setUniform2fv("u_targetImageSize", [a23, f3]), i13.setUniform2fv("u_transformSpacing", m7 ? m7.spacing : l), i13.setUniform2fv("u_transformGridSize", m7 ? m7.size : l);
}
var s17 = { createProgram: i11, bindTextureAndUniforms: o9 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/slopeProcessor.js
var r14 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/slope", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function s18(e17, t6) {
  const { painter: s19, rasterFunction: o13 } = e17, { slopeType: a23, isOutputRounded: i13 } = o13.parameters, n26 = [];
  return "percent-rise" === a23 && n26.push("percentRise"), i13 && n26.push("roundOutput"), s19.materialManager.getProgram(r14, n26);
}
function o10(r16, s19, o13) {
  s4(r16, s19, o13), i9(s19);
  const a23 = o13.getRasterTextureSize();
  s19.setUniform2fv("u_srcImageSize", a23);
  const i13 = o13.getRasterCellSize();
  s19.setUniform2fv("u_cellSize", i13);
  const { zFactor: n26, slopeType: u4, pixelSizePower: p6, pixelSizeFactor: c5 } = r16.rasterFunction.parameters;
  s19.setUniform1f("u_zFactor", n26), s19.setUniform1f("u_pixelSizePower", "adjusted" === u4 ? p6 : 0), s19.setUniform1f("u_pixelSizeFactor", "adjusted" === u4 ? c5 : 0);
}
var a19 = { createProgram: s18, bindTextureAndUniforms: o10 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/stretchProcessor.js
var a20 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/stretch", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function u3(t6, r16) {
  const { useGamma: u4, bandCount: e17, isOutputRounded: n26 } = t6.rasterFunction.parameters, m7 = [];
  return u4 && m7.push("useGamma"), e17 > 1 && m7.push("multiBand"), n26 && m7.push("roundOutput"), t6.painter.materialManager.getProgram(a20, m7);
}
function e16(a23, u4, e17) {
  s4(a23, u4, e17), i9(u4);
  const { width: n26, height: m7 } = e17, o13 = a23.rasterFunction.parameters;
  u4.setUniform2fv("u_srcImageSize", [n26, m7]), u4.setUniform1f("u_minOutput", o13.minOutput), u4.setUniform1f("u_maxOutput", o13.maxOutput), u4.setUniform1fv("u_factor", o13.factor), u4.setUniform1fv("u_minCutOff", o13.minCutOff), u4.setUniform1fv("u_maxCutOff", o13.maxCutOff), u4.setUniform1fv("u_gamma", o13.gamma), u4.setUniform1fv("u_gammaCorrection", o13.gammaCorrection);
}
var n24 = { createProgram: u3, bindTextureAndUniforms: e16 };

// node_modules/@arcgis/core/views/2d/engine/imagery/processor/rasterProcessor.js
var F = /* @__PURE__ */ new Map();
function R2(r16, e17) {
  const o13 = new p2();
  return o13.width = r16, o13.height = e17, o13.internalFormat = P2.RGBA32F, o13.samplingMode = L.NEAREST, o13.dataType = U.FLOAT, o13.isImmutable = true, o13.wrapMode = D.CLAMP_TO_EDGE, o13;
}
function y2(r16, e17, o13, t6) {
  const { context: s19, requestRender: c5, allowDelayedRender: i13 } = r16, n26 = t6.createProgram(r16, o13);
  return i13 && null != c5 && !n26.compiled ? (c5(), null) : (s19.bindFramebuffer(e17), s19.setViewport(0, 0, e17.width, e17.height), s19.useProgram(n26), n26);
}
function B(r16) {
  return F.get(r16.toLowerCase());
}
function C2(r16, e17, o13, t6) {
  const s19 = r16.rasterFunction.name.toLowerCase(), c5 = "reproject" === s19 ? s17 : B(s19);
  if (null == c5) return;
  const i13 = y2(r16, o13, t6, c5);
  if (!i13) return;
  c5.bindTextureAndUniforms(r16, i13, t6);
  const { interpolation: n26 } = t6;
  "reproject" === s19 && (t6.interpolation = "nearest"), e17.draw();
  const [m7, a23] = t6.getRasterTextureSize("reproject" === s19), p6 = R2(m7, a23), l4 = new w2(r16.context, p6);
  if (o13.copyToTexture(0, 0, m7, a23, 0, 0, l4), "reproject" === s19) t6.rasterTexture = l4, t6.projected = true, t6.interpolation = n26;
  else {
    const e18 = r16.hasBranches ? r16.rasterFunction.id : 0;
    t6.functionTextures[e18] = l4;
  }
}
F.set("arithmetic", o8), F.set("aspect", n10), F.set("bandarithmetic", s6), F.set("colormaptorgb", n12), F.set("computechange", s8), F.set("compositeband", s7), F.set("convolution", o5), F.set("contrastbrightness", n15), F.set("curvature", n17), F.set("extractband", o6), F.set("statistics", n19), F.set("grayscale", n20), F.set("hillshade", i10), F.set("shadedrelief", i10), F.set("local", o8), F.set("mask", s14), F.set("ndvi", s15), F.set("remap", s16), F.set("slope", a19), F.set("stretch", n24);

// node_modules/@arcgis/core/views/2d/engine/imagery/BrushRasterBitmap.js
var h5 = class extends t4 {
  constructor() {
    super(...arguments), this.name = "raster", this._quad = null, this._rendererUniformInfos = /* @__PURE__ */ new Map(), this._fbo = null;
  }
  dispose() {
    r2(this._quad), r2(this._fbo);
  }
  prepareState(e17) {
    const { context: t6, renderPass: r16 } = e17, s19 = "raster" === r16;
    t6.setBlendingEnabled(!s19), t6.setBlendFunctionSeparate(R.ONE, R.ONE_MINUS_SRC_ALPHA, R.ONE, R.ONE_MINUS_SRC_ALPHA), t6.setColorMask(true, true, true, true), t6.setStencilWriteMask(0), t6.setStencilTestEnabled(!s19);
  }
  draw(e17, r16) {
    if (!m3(r16) || r16.suspended) return;
    const { renderPass: s19 } = e17;
    if ("raster-bitmap" !== s19) return "raster" === s19 ? this._process(e17, r16) : void this._drawBitmap(e17, r16, true);
    this._drawBitmap(e17, r16);
  }
  _process(t6, r16) {
    const { rasterFunction: i13 } = t6, o13 = "Reproject" === i13.name;
    if (!(o13 ? !(r16.rasterTexture && r16.projected) : !r16.processed)) return;
    const { timeline: n26, context: a23 } = t6;
    n26.begin(this.name);
    const d4 = a23.getBoundFramebufferObject(), c5 = a23.getViewport();
    o13 || (r16.processedTexture = r2(r16.processedTexture)), a23.setStencilFunction(O.EQUAL, r16.stencilRef, 255), r16.updateTexture(t6), this._initQuad(a23);
    const [f3, u4] = r16.getRasterTextureSize(o13), { isStandardRasterTileSize: p6, fbo: h6 } = this._getRasterFBO(a23, f3, u4);
    C2(t6, this._quad, h6, r16), p6 || h6.dispose(), a23.bindFramebuffer(d4), a23.setViewport(c5.x, c5.y, c5.width, c5.height), n26.end(this.name);
  }
  _drawBitmap(e17, t6, s19 = false) {
    const { timeline: i13, context: o13 } = e17;
    if (i13.begin(this.name), o13.setStencilFunction(O.EQUAL, t6.stencilRef, 255), t6.updateTexture(e17), s19 && !t6.processedTexture) {
      if (t6.updateProcessedTexture(), !t6.processedTexture) return void i13.end(this.name);
      t6.processed = true;
    }
    this._initBitmapCommonUniforms(t6);
    const a23 = t6.symbolizerParameters.type, d4 = o3(a23), { requestRender: c5, allowDelayedRender: f3 } = e17, { defines: u4, program: p6 } = d4.createProgram(e17, t6, t6.projected && s19);
    if (f3 && null != c5 && !p6.compiled) return void c5();
    o13.useProgram(p6);
    const h6 = this._getUniformInfos(a23, o13, p6, u4);
    this._quad || (this._quad = new n4(o13, [0, 0, 1, 0, 0, 1, 1, 1])), d4.bindTextureAndUniforms(e17, p6, t6, h6, s19), this._quad.draw(), i13.end(this.name);
  }
  _initBitmapCommonUniforms(e17) {
    if (!e17.commonUniforms) {
      const t6 = g5(1, [0, 0]), { transformGrid: r16, width: s19, height: i13 } = e17, o13 = l2(r16, [s19, i13], [e17.source.width, e17.source.height], 1, false);
      e17.commonUniforms = { ...t6, ...o13, u_coordScale: e17.coordScale };
    }
  }
  _getRasterFBO(e17, t6, r16) {
    const s19 = t6 === a2 && r16 === a2;
    return s19 ? (this._fbo || (this._fbo = this._createNewFBO(e17, t6, r16)), { isStandardRasterTileSize: s19, fbo: this._fbo }) : { isStandardRasterTileSize: s19, fbo: this._createNewFBO(e17, t6, r16) };
  }
  _createNewFBO(e17, t6, r16) {
    const s19 = R2(t6, r16);
    return new x(e17, s19);
  }
  _initQuad(e17) {
    this._quad || (this._quad = new n4(e17, [0, 0, 1, 0, 0, 1, 1, 1]));
  }
  _getUniformInfos(e17, t6, r16, s19) {
    const i13 = s19.length > 0 ? e17 + "-" + s19.join("-") : e17;
    if (this._rendererUniformInfos.has(i13)) return this._rendererUniformInfos.get(i13);
    const o13 = T(t6, r16);
    return this._rendererUniformInfos.set(i13, o13), o13;
  }
};

// node_modules/@arcgis/core/views/2d/engine/imagery/RasterTile.js
var i12 = class extends r5 {
  constructor(t6, e17, i13, a23, r16, l4, n26 = null) {
    super(t6, e17, i13, a23, r16, l4), this.bitmap = null, this.bitmap = new _3(n26, null, null), this.bitmap.coordScale = [r16, l4], this.bitmap.once("isReady", () => this.ready());
  }
  destroy() {
    super.destroy(), this.bitmap.destroy(), this.bitmap = null, this.stage = null;
  }
  set stencilRef(t6) {
    this.bitmap.stencilRef = t6;
  }
  get stencilRef() {
    return this.bitmap.stencilRef;
  }
  setTransform(t6) {
    super.setTransform(t6), this.bitmap.transforms.displayViewScreenMat3 = this.transforms.displayViewScreenMat3;
  }
  _createTransforms() {
    return { displayViewScreenMat3: e(), tileMat3: e() };
  }
  onAttach() {
    this.bitmap.stage = this.stage;
  }
  onDetach() {
    this.bitmap.stage = null;
  }
};

// node_modules/@arcgis/core/views/2d/engine/imagery/RasterTileContainer.js
var o11 = class extends i3 {
  constructor() {
    super(...arguments), this.isCustomTilingScheme = false;
  }
  createTile(e17) {
    const r16 = this._getTileBounds(e17), [s19, i13] = this.tileInfoView.tileInfo.size, n26 = this.tileInfoView.getTileResolution(e17.level);
    return new i12(e17, n26, r16[0], r16[3], s19, i13);
  }
  prepareRenderPasses(e17) {
    const r16 = e17.registerRenderPass({ name: "imagery (tile)", brushes: [h5], target: () => this.children.map((e18) => e18.bitmap), drawPhase: E.MAP });
    return [...super.prepareRenderPasses(e17), r16];
  }
  doRender(e17) {
    if (!this.visible || e17.drawPhase !== E.MAP) return;
    const { rasterFunctionChain: r16 } = this;
    if (!r16) return e17.renderPass = "raster-bitmap", void super.doRender(e17);
    if (!r16.hasFocalFunction) {
      const [s19, t6] = this.tileInfoView.tileInfo.size;
      e17.renderPass = "raster", e17.rasterFunction = { name: "Reproject", parameters: { targetImageSize: [s19, t6], requireNNEdge: r16.isSourceSingleBand }, pixelType: "f32", id: 0, isNoopProcess: false }, super.doRender(e17);
    }
    if (r16 == null ? void 0 : r16.functions.length) {
      const { functions: s19, hasBranches: t6 } = r16;
      for (let r17 = 0; r17 < s19.length; r17++) {
        const i13 = s19[r17];
        "Constant" !== i13.name && "Identity" !== i13.name && (e17.renderPass = "raster", e17.rasterFunction = i13, e17.hasBranches = t6, super.doRender(e17));
      }
    }
    e17.rasterFunction = null, e17.renderPass = "bitmap", super.doRender(e17);
  }
  _getTileBounds(s19) {
    const t6 = this.tileInfoView.getTileBounds(u(), s19);
    if (this.isCustomTilingScheme && s19.world) {
      const { tileInfo: e17 } = this.tileInfoView, i13 = mt(e17.spatialReference);
      if (i13) {
        const r16 = e17.lodAt(s19.level);
        if (!r16) return t6;
        const { resolution: n26 } = r16, o13 = n26 * e17.size[0];
        t6[0] = i13 * s19.world + e17.origin.x + s19.col * o13, t6[2] = t6[0] + o13;
      }
    }
    return t6;
  }
};

// node_modules/@arcgis/core/views/2d/layers/imagery/BaseImageryTileSubView2D.js
var S3 = [0, 0];
var v = class extends g {
  constructor() {
    super(...arguments), this._updatingHandles = new h2(), this._emptyTilePixelBlock = null, this._tileStrategy = null, this._tileInfoView = null, this._fetchQueue = null, this._blockCacheRegistryUrl = null, this._blockCacheRegistryId = null, this._srcResolutions = [], this.previousLOD = null, this._needBlockCacheUpdate = false, this._globalSymbolizerParams = null, this._symbolizerParams = null, this._abortController = null, this._isCustomTilingScheme = false, this._maxIndexedColormapSize = 0, this._rasterFunctionState = "na", this._globalUpdateRequested = false, this.attached = false, this.timeExtent = null, this.redrawOrRefetch = k(async (e17 = {}) => {
      const t6 = this._rasterFunctionState;
      if (e17.reprocess && (await this._updatingHandles.addPromise(this.layer.updateRasterFunction()), this.updateRasterFunctionParameters()), !this.previousLOD || this.layerView.suspended) return;
      const i13 = this._rasterFunctionState, { type: s19 } = this;
      return e17.refetch || "raster" !== s19 && !!e17.reprocess || "cpu" === i13 || "cpu" === t6 ? this._updatingHandles.addPromise(this.doRefresh()) : this._updatingHandles.addPromise(this._redrawImage(e17.signal));
    });
  }
  destroy() {
    this._updatingHandles.destroy();
  }
  get useWebGLForProcessing() {
    return this._get("useWebGLForProcessing") ?? true;
  }
  set useWebGLForProcessing(e17) {
    this._set("useWebGLForProcessing", e17);
  }
  get useProgressiveUpdate() {
    return this._get("useProgressiveUpdate") ?? true;
  }
  set useProgressiveUpdate(e17) {
    if (this._tileStrategy && this.useProgressiveUpdate !== e17) {
      this._tileStrategy.destroy(), this.container.removeAllChildren();
      const t6 = this._getCacheSize(e17);
      this._tileStrategy = new r4({ cachePolicy: "purge", acquireTile: (e18) => this.acquireTile(e18), releaseTile: (e18) => this.releaseTile(e18), cacheSize: t6, tileInfoView: this._tileInfoView }), this._set("useProgressiveUpdate", e17), this.layerView.requestUpdate();
    }
  }
  update(e17) {
    var _a;
    this._fetchQueue.pause(), this._fetchQueue.state = e17.state, this._tileStrategy.update(e17), this._fetchQueue.resume();
    const { extent: t6, resolution: i13, scale: s19 } = e17.state, r16 = this._tileInfoView.getClosestInfoForScale(s19);
    if (this.layer.raster) {
      if (!this.useProgressiveUpdate || this._needBlockCacheUpdate) {
        const e18 = this._srcResolutions[r16.level], s20 = "toJSON" in t6 ? t6 : w.fromJSON(t6);
        g4(this._blockCacheRegistryUrl, this._blockCacheRegistryId, s20, i13, e18, this.layer.raster.ioConfig.sampling);
      }
      this._needBlockCacheUpdate = false, ((_a = this.previousLOD) == null ? void 0 : _a.level) !== r16.level && (this.previousLOD = r16, null == this._symbolizerParams || this.layerView.hasTilingEffects || this._updateSymbolizerParams(), this._tileStrategy.updateCacheSize(0));
    }
  }
  moveEnd() {
    !this.layerView.hasTilingEffects && this.useProgressiveUpdate || (this._abortController && this._abortController.abort(), this._abortController = new AbortController(), 0 === this._fetchQueue.length && this._redrawImage(this._abortController.signal).then(() => {
      this._globalUpdateRequested = false, this.layerView.requestUpdate();
    }));
    const e17 = this._getCacheSize(this.useProgressiveUpdate);
    this._tileStrategy.updateCacheSize(e17), this.layerView.requestUpdate();
  }
  get updating() {
    var _a;
    return this._globalUpdateRequested || ((_a = this._updatingHandles) == null ? void 0 : _a.updating);
  }
  attach() {
    const e17 = t3();
    this._maxIndexedColormapSize = 4 * (e17.maxTextureSize || 4096), this._initializeTileInfo(), this._tileInfoView = new h3(this.layerView.tileInfo, this.layerView.fullExtent);
    const t6 = this._computeFetchConcurrency();
    this._fetchQueue = new p({ tileInfoView: this._tileInfoView, concurrency: t6, process: (e18, t7) => this._fetchTile(e18, t7), priority: g2.MAPVIEW_FETCH_QUEUE, scheduler: this.scheduler });
    const i13 = this._getCacheSize(this.useProgressiveUpdate);
    this._tileStrategy = new r4({ cachePolicy: "purge", acquireTile: (e18) => this.acquireTile(e18), releaseTile: (e18) => this.releaseTile(e18), cacheSize: i13, tileInfoView: this._tileInfoView }), this._updateBlockCacheRegistry();
  }
  detach() {
    this._tileStrategy.destroy(), this._fetchQueue.clear(), this.container.removeAllChildren(), this._fetchQueue = this._tileStrategy = this._tileInfoView = null, a3(this._blockCacheRegistryUrl, this._blockCacheRegistryId), this._blockCacheRegistryUrl = this._blockCacheRegistryId = null;
  }
  acquireTile(e17) {
    const t6 = this.container.createTile(e17);
    return this._updatingHandles.addPromise(this._enqueueTileFetch(t6)), this.layerView.requestUpdate(), this._needBlockCacheUpdate = true, this._globalUpdateRequested = this.layerView.hasTilingEffects || !this.useProgressiveUpdate, t6;
  }
  releaseTile(e17) {
    this._fetchQueue.abort(e17.key.id), this.container.removeChild(e17), e17.once("detach", () => {
      e17.destroy(), this.layerView.requestUpdate();
    }), this.layerView.requestUpdate();
  }
  createEmptyTilePixelBlock(e17 = null) {
    const t6 = null == e17 || e17.join(",") === this._tileInfoView.tileInfo.size.join(",");
    if (t6 && null != this._emptyTilePixelBlock) return this._emptyTilePixelBlock;
    e17 = e17 || this._tileInfoView.tileInfo.size;
    const [i13, s19] = e17, r16 = new g3({ width: i13, height: s19, pixels: [new Uint8Array(i13 * s19)], mask: new Uint8Array(i13 * s19), pixelType: "u8" });
    return t6 && (this._emptyTilePixelBlock = r16), r16;
  }
  _getBandIds() {
    if (!("rasterFunctionChain" in this.container) || !this.container.rasterFunctionChain) return this.layer.bandIds;
    const { bandIds: e17, raster: t6 } = this.layer, i13 = "rasterFunction" in t6 ? t6.rasterFunction.rawInputBandIds : null;
    return (e17 == null ? void 0 : e17.length) && (i13 == null ? void 0 : i13.length) && 1 !== t6.rasterInfo.bandCount ? e17.map((e18) => i13[Math.min(e18, i13.length - 1)]) : "rasterFunction" in t6 ? i13 : e17;
  }
  updateRasterFunctionParameters() {
  }
  _fetchTile(e17, t6) {
    const i13 = this._getFetchOptions(e17.level, t6.signal);
    return this.fetchTile(e17, i13);
  }
  _getFetchOptions(e17, t6) {
    const i13 = this.canUseWebGLForProcessing(), { layerView: s19 } = this, { tileInfo: r16 } = s19, a23 = !r16.isWrappable && null != te(s19.view.spatialReference), o13 = i13 && this.layer.raster.hasUniqueSourceStorageInfo;
    return { allowPartialFill: true, datumTransformation: s19.datumTransformation, interpolation: i13 ? "nearest" : this.layer.interpolation, registryId: this._blockCacheRegistryId, requestRawData: o13, skipRasterFunction: "raster" === this.type && null != this.container.rasterFunctionChain, signal: t6, srcResolution: this._srcResolutions[e17], timeExtent: s19.timeExtent, tileInfo: r16, disableWrapAround: a23 };
  }
  _getCacheSize(e17) {
    return e17 ? 40 : 0;
  }
  _initializeTileInfo() {
    const { layerView: e17 } = this, t6 = e17.view.spatialReference;
    if (this._canUseLayerLODs()) {
      const { origin: i14, lods: s19 } = this.layer.tileInfo, r17 = s19.map(({ scale: e18 }) => e18), a24 = z.create({ spatialReference: t6, size: a2, scales: r17, origin: i14 });
      return e17.set("tileInfo", a24), void (this._srcResolutions = s19.map(({ resolution: e18 }) => ({ x: e18, y: e18 })));
    }
    const { scales: i13, srcResolutions: r16, isCustomTilingScheme: a23 } = he(this.layer.serviceRasterInfo, t6, { tileSize: a2, alignGlobalDatasetWithAGOL: true, limitToSrcResolution: false }), o13 = z.create({ spatialReference: t6, size: a2, scales: i13 }), l4 = 0 === o13.origin.x;
    n2(e17.fullExtent);
    const { xmin: n26, ymax: h6 } = e17.fullExtent;
    (l4 || a23 && o13.origin.x > n26) && (o13.origin = new j({ x: n26, y: h6, spatialReference: t6 })), this._isCustomTilingScheme = a23, e17.set("tileInfo", o13), this._srcResolutions = r16 ?? [];
  }
  _canUseLayerLODs() {
    var _a;
    const { layer: e17, layerView: t6 } = this;
    if ("Map" !== e17.raster.tileType) return false;
    const { lods: i13 } = e17.tileInfo, s19 = (_a = t6.view.constraints) == null ? void 0 : _a.effectiveLODs;
    return (s19 == null ? void 0 : s19.length) === i13.length && s19.every(({ scale: e18 }, t7) => Math.abs(e18 - i13[t7].scale) < 1e-3);
  }
  _computeFetchConcurrency() {
    const { blockBoundary: e17 } = this.layer.serviceRasterInfo.storageInfo, t6 = e17[e17.length - 1];
    return (t6.maxCol - t6.minCol + 1) * (t6.maxRow - t6.minRow + 1) > 64 ? 2 : 10;
  }
  async _enqueueTileFetch(e17, t6) {
    var _a;
    if (!this._fetchQueue.has(e17.key.id)) {
      try {
        const t7 = await this._fetchQueue.push(e17.key), r16 = this._getBandIds();
        let o13 = !this.useProgressiveUpdate || this.layerView.hasTilingEffects && !this._globalSymbolizerParams;
        if (this._globalUpdateRequested && !this.layerView.moving && 0 === this._fetchQueue.length) {
          o13 = false;
          try {
            await this._redrawImage((_a = this._abortController) == null ? void 0 : _a.signal);
          } catch (s19) {
            b(s19) && n.getLogger(this).error(s19);
          }
          this._globalUpdateRequested = false;
        }
        !this.canUseWebGLForProcessing() && "rasterVF" !== this.type || this.layerView.hasTilingEffects || null != this._symbolizerParams || this._updateSymbolizerParams();
        const l4 = this._tileInfoView.getTileCoords(S3, e17.key), n26 = this._tileInfoView.getTileResolution(e17.key);
        await this.updateTileSource(e17, { source: t7, symbolizerParams: this._symbolizerParams, globalSymbolizerParams: this._globalSymbolizerParams, suspended: o13, bandIds: r16, coords: l4, resolution: n26 }), e17.once("attach", () => this.layerView.requestUpdate()), this.container.addChild(e17);
      } catch (s19) {
        b(s19) || n.getLogger(this).error(s19);
      }
      this.layerView.requestUpdate();
    }
  }
  async _redrawImage(e17) {
    if (0 === this.container.children.length) return;
    await this.layer.updateRenderer(), this.layerView.hasTilingEffects ? await this._updateGlobalSymbolizerParams(e17) : (this._updateSymbolizerParams(), this._globalSymbolizerParams = null);
    const t6 = this.container.children.map(async (e18) => this.updateTileSymbolizerParameters(e18, { local: this._symbolizerParams, global: this._globalSymbolizerParams }));
    await Promise.allSettled(t6), this.container.requestRender();
  }
  async _updateGlobalSymbolizerParams(e17) {
    const t6 = this._getFetchOptions(this.previousLOD.level, e17), i13 = await this.layer.fetchPixels(this.layerView.view.extent, this.layerView.view.width, this.layerView.view.height, { ...t6, interpolation: "nearest", requestRawData: false, skipRasterFunction: false });
    if (!(i13 == null ? void 0 : i13.pixelBlock)) return;
    const { resolution: s19 } = this.previousLOD, r16 = this._getBandIds(), a23 = this.layer.symbolizer.generateWebGLParameters({ pixelBlock: i13.pixelBlock.extractBands(r16), isGCS: this.layerView.view.spatialReference.isGeographic, resolution: { x: s19, y: s19 }, bandIds: r16 });
    !this.canUseWebGLForProcessing() && a23 && "stretch" === a23.type && this.layer.renderer && "raster-stretch" === this.layer.renderer.type && (a23.factor = a23.factor.map((e18) => 255 * e18), a23.minOutput = Math.round(255 * a23.minOutput), a23.maxOutput = Math.round(255 * a23.maxOutput)), this._globalSymbolizerParams = a23;
  }
  _updateSymbolizerParams() {
    const { resolution: e17 } = this.previousLOD, t6 = this._getBandIds();
    this._symbolizerParams = this.layer.symbolizer.generateWebGLParameters({ pixelBlock: null, isGCS: this.layerView.view.spatialReference.isGeographic, resolution: { x: e17, y: e17 }, bandIds: t6 });
  }
  _updateBlockCacheRegistry(e17 = false) {
    const { layer: t6, layerView: i13 } = this, { raster: s19 } = t6, { multidimensionalDefinition: r16 } = t6.normalizeRasterFetchOptions({ multidimensionalDefinition: t6.multidimensionalDefinition, timeExtent: i13.timeExtent }), a23 = s19.rasterInfo.multidimensionalInfo ? s19.getSliceIndex(r16) : null, o13 = i2(s19.rasterId, a23);
    if (o13 !== this._blockCacheRegistryUrl) {
      if (null != this._blockCacheRegistryUrl && a3(this._blockCacheRegistryUrl, this._blockCacheRegistryId), this._blockCacheRegistryId = u2(o13, s19.rasterInfo), e17) {
        const { view: e18 } = i13, t7 = this._tileInfoView.getClosestInfoForScale(e18.scale), r17 = this._srcResolutions[t7.level];
        g4(o13, this._blockCacheRegistryId, e18.extent, e18.resolution, r17, s19.ioConfig.sampling);
      }
      this._blockCacheRegistryUrl = o13;
    }
  }
  async doRefresh() {
    if (!this.attached || !this.previousLOD || this.layerView.suspended) return;
    await this.layer.updateRenderer(), this.layerView.hasTilingEffects || this._updateSymbolizerParams(), this._updateBlockCacheRegistry(true), this._fetchQueue.reset();
    const e17 = [];
    this._globalUpdateRequested = this.layerView.hasTilingEffects || !this.useProgressiveUpdate, this._tileStrategy.refresh((t6) => e17.push(this._enqueueTileFetch(t6))), await this._updatingHandles.addPromise(Promise.allSettled(e17));
  }
};
r([m()], v.prototype, "_globalUpdateRequested", void 0), r([m()], v.prototype, "attached", void 0), r([m()], v.prototype, "container", void 0), r([m()], v.prototype, "layer", void 0), r([m()], v.prototype, "layerView", void 0), r([m()], v.prototype, "scheduler", void 0), r([m()], v.prototype, "type", void 0), r([m()], v.prototype, "useWebGLForProcessing", null), r([m()], v.prototype, "useProgressiveUpdate", null), r([m()], v.prototype, "timeExtent", void 0), r([m()], v.prototype, "updating", null), v = r([a("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")], v);

// node_modules/@arcgis/core/views/2d/layers/imagery/ImageryTileView2D.js
var a21 = class extends v {
  constructor() {
    super(...arguments), this.type = "raster";
  }
  attach() {
    super.attach(), this.container = new o11(this._tileInfoView), this.container.isCustomTilingScheme = this._isCustomTilingScheme, this.updateRasterFunctionParameters();
  }
  detach() {
    super.detach(), this.container.removeAllChildren(), this.container = null;
  }
  canUseWebGLForProcessing() {
    var _a, _b;
    const { symbolizer: e17 } = this.layer, t6 = (_b = (_a = e17.lookup) == null ? void 0 : _a.colormapLut) == null ? void 0 : _b.indexedColormap, r16 = t6 && t6.length > this._maxIndexedColormapSize;
    return this.useWebGLForProcessing && e17.canRenderInWebGL && !r16 && !("majority" === this.layer.interpolation && p4(this.layer));
  }
  fetchTile(e17, t6) {
    return this.layer.fetchTile(e17.level, e17.row, e17.col, t6);
  }
  updateRasterFunctionParameters() {
    var _a;
    const { clips: e17, view: t6 } = this.layerView;
    null != this._geometry && e17.remove(this._geometry);
    const { raster: r16, type: s19 } = this.layer;
    if ("Function" === r16.datasetFormat) {
      const s20 = r16.getClippingGeometry(t6.spatialReference);
      if (s20) {
        const t7 = new a4({ geometry: s20 });
        e17.add(t7), this._geometry = t7;
      }
    }
    const { container: i13 } = this;
    if ("Function" !== r16.datasetFormat || "wcs" === s19) return i13.rasterFunctionChain = null, i13.children.forEach((e18) => {
      const { bitmap: t7 } = e18;
      t7 && (t7.suspended = true, t7.processed = false, t7.projected && (t7.invalidateTexture(), t7.rasterTexture = null));
    }), void (this._rasterFunctionState = "na");
    const o13 = this._rasterFunctionState, { rasterFunction: a23, primaryRasters: l4 } = r16, c5 = a23.supportsGPU && (!l4 || l4.rasters.length <= 1), u4 = c5 ? a23.flatWebGLFunctionChain : null, { renderer: p6 } = this.layer, d4 = !c5 || !(u4 == null ? void 0 : u4.functions.length) || "raster-stretch" === (p6 == null ? void 0 : p6.type) && p6.dynamicRangeAdjustment || !this.canUseWebGLForProcessing();
    i13.rasterFunctionChain = d4 ? null : u4;
    const h6 = null == a23 ? "na" : i13.rasterFunctionChain ? "gpu" : "cpu", m7 = o13 === h6 || "na" === o13 && "cpu" === h6 && 0 === ((_a = u4 == null ? void 0 : u4.functions) == null ? void 0 : _a.length);
    i13.children.forEach((e18) => {
      const { bitmap: t7 } = e18;
      t7 && (t7.suspended = !m7, t7.processed = false, t7.processedTexture = null);
    }), this._rasterFunctionState = h6;
  }
  async updateTileSource(e17, t6) {
    const r16 = this._getBandIds(), s19 = this._getLayerInterpolation(), i13 = this.canUseWebGLForProcessing(), { source: o13, globalSymbolizerParams: n26, suspended: a23, coords: l4, resolution: c5 } = t6, u4 = this.layerView.hasTilingEffects ? n26 : t6.symbolizerParams, { bitmap: p6 } = e17;
    if ([p6.x, p6.y] = l4, p6.resolution = c5, null != (o13 == null ? void 0 : o13.pixelBlock)) {
      const e18 = { extent: o13.extent, pixelBlock: o13.pixelBlock, srcPixelSize: o13.srcTilePixelSize };
      if (p6.rawPixelData = e18, i13) p6.source = o13.pixelBlock, p6.isRendereredSource = false;
      else {
        const t7 = await this.layer.applyRenderer(e18, "stretch" === (n26 == null ? void 0 : n26.type) ? n26 : void 0);
        p6.source = t7, p6.isRendereredSource = true;
      }
      p6.symbolizerParameters = i13 ? u4 : null, p6.transformGrid = i13 ? o13.transformGrid : null;
    } else {
      const e18 = this.createEmptyTilePixelBlock();
      p6.source = e18, p6.symbolizerParameters = i13 ? u4 : null, p6.transformGrid = null;
    }
    p6.bandIds = i13 ? r16 : null, p6.width = this._tileInfoView.tileInfo.size[0], p6.height = this._tileInfoView.tileInfo.size[1], p6.interpolation = s19, p6.suspended = a23, p6.invalidateTexture();
  }
  async updateTileSymbolizerParameters(e17, t6) {
    const { local: r16, global: s19 } = t6, i13 = this._getBandIds(), o13 = this._getLayerInterpolation(), n26 = this.canUseWebGLForProcessing(), { bitmap: a23 } = e17, { rawPixelData: l4 } = a23;
    n26 || null == l4 ? (a23.isRendereredSource && null != l4 && (a23.source = l4.pixelBlock), a23.isRendereredSource = false) : (a23.source = await this.layer.applyRenderer(l4, "stretch" === (s19 == null ? void 0 : s19.type) ? s19 : void 0), a23.isRendereredSource = true), a23.symbolizerParameters = n26 ? this.layerView.hasTilingEffects ? s19 : r16 : null, a23.bandIds = n26 ? i13 : null, a23.interpolation = o13, a23.suspended = false;
  }
  _getLayerInterpolation() {
    const { interpolation: e17, renderer: t6 } = this.layer;
    if (!t6) return e17;
    const r16 = t6.type;
    return "raster-colormap" === r16 || "unique-value" === r16 ? "nearest" : "raster-stretch" === t6.type && null != t6.colorRamp ? "bilinear" === e17 || "cubic" === e17 ? "bilinear" : "nearest" : e17;
  }
};
r([m()], a21.prototype, "container", void 0), r([m()], a21.prototype, "layer", void 0), r([m()], a21.prototype, "type", void 0), a21 = r([a("esri.views.2d.layers.imagery.ImageryTileView2D")], a21);
var l3 = a21;

// node_modules/@arcgis/core/views/2d/engine/imagery/RasterVFTile.js
var r15 = class extends r5 {
  constructor(t6, e17, s19, a23, r16, l4, o13 = null) {
    super(t6, e17, s19, a23, r16, l4), this.tileData = new f(o13), this.tileData.coordScale = [r16, l4], this.tileData.once("isReady", () => this.ready());
  }
  destroy() {
    super.destroy(), this.tileData.destroy(), this.tileData = null, this.stage = null;
  }
  set stencilRef(t6) {
    this.tileData.stencilRef = t6;
  }
  get stencilRef() {
    return this.tileData.stencilRef;
  }
  _createTransforms() {
    return { displayViewScreenMat3: e(), tileMat3: e() };
  }
  setTransform(s19) {
    super.setTransform(s19);
    const i13 = this.resolution / (s19.resolution * s19.pixelRatio), a23 = this.transforms.tileMat3, [r16, l4] = this.tileData.offset, o13 = [this.x + r16 * this.resolution, this.y - l4 * this.resolution], [n26, h6] = s19.toScreenNoRotation([0, 0], o13), { symbolTileSize: c5 } = this.tileData.symbolizerParameters, f3 = Math.round((this.width - this.tileData.offset[0]) / c5) * c5, m7 = Math.round((this.height - this.tileData.offset[1]) / c5) * c5, D2 = f3 / this.rangeX * i13, d4 = m7 / this.rangeY * i13;
    r3(a23, D2, 0, 0, 0, d4, 0, n26, h6, 1), i(this.transforms.displayViewScreenMat3, s19.displayViewMat3, a23), this.tileData.transforms.displayViewScreenMat3 = this.transforms.displayViewScreenMat3;
  }
  onAttach() {
    this.tileData.stage = this.stage;
  }
  onDetach() {
    this.tileData.stage = null;
  }
};

// node_modules/@arcgis/core/views/2d/engine/imagery/RasterVFTileContainer.js
var o12 = class extends i3 {
  constructor() {
    super(...arguments), this.isCustomTilingScheme = false, this.symbolTypes = ["triangle"];
  }
  createTile(s19) {
    const t6 = this.tileInfoView.getTileBounds(u(), s19), [i13, o13] = this.tileInfoView.tileInfo.size, n26 = this.tileInfoView.getTileResolution(s19.level);
    return new r15(s19, n26, t6[0], t6[3], i13, o13);
  }
  prepareRenderPasses(e17) {
    const r16 = e17.registerRenderPass({ name: "imagery (vf tile)", brushes: [d3], target: () => this.children.map((e18) => e18.tileData), drawPhase: E.MAP });
    return [...super.prepareRenderPasses(e17), r16];
  }
  doRender(e17) {
    this.visible && e17.drawPhase === E.MAP && this.symbolTypes.forEach((s19) => {
      e17.renderPass = s19, super.doRender(e17);
    });
  }
};

// node_modules/@arcgis/core/views/2d/layers/imagery/VectorFieldTileView2D.js
var a22 = class extends v {
  constructor() {
    super(...arguments), this._handle = null, this.type = "rasterVF";
  }
  canUseWebGLForProcessing() {
    return false;
  }
  async fetchTile(e17, t6) {
    var _a;
    t6 = { ...t6, interpolation: "nearest", requestProjectedLocalDirections: true };
    const i13 = await this.layer.fetchTile(e17.level, e17.row, e17.col, t6);
    return "vector-magdir" === ((_a = this.layer.serviceRasterInfo) == null ? void 0 : _a.dataType) && (i13 == null ? void 0 : i13.pixelBlock) && (i13.pixelBlock = await this.layer.convertVectorFieldData(i13.pixelBlock, t6)), i13;
  }
  updateTileSource(e17, t6) {
    const i13 = t6.symbolizerParams, { tileData: r16 } = e17;
    r16.key = e17.key, r16.width = this._tileInfoView.tileInfo.size[0], r16.height = this._tileInfoView.tileInfo.size[1];
    const { symbolTileSize: o13 } = i13, { source: s19 } = t6;
    if (r16.offset = this._getTileSymbolOffset(r16.key, o13), null != (s19 == null ? void 0 : s19.pixelBlock)) {
      const e18 = { extent: s19.extent, pixelBlock: s19.pixelBlock };
      r16.rawPixelData = e18, r16.symbolizerParameters = i13, r16.source = this._sampleVectorFieldData(s19.pixelBlock, i13, r16.offset);
    } else {
      const e18 = [Math.round((this._tileInfoView.tileInfo.size[0] - r16.offset[0]) / o13), Math.round((this._tileInfoView.tileInfo.size[1] - r16.offset[1]) / o13)], t7 = this.createEmptyTilePixelBlock(e18);
      r16.source = t7, r16.symbolizerParameters = i13;
    }
    return r16.invalidateVAO(), Promise.resolve();
  }
  updateTileSymbolizerParameters(e17, t6) {
    var _a;
    const i13 = t6.local, { symbolTileSize: r16 } = i13, { tileData: o13 } = e17;
    o13.offset = this._getTileSymbolOffset(o13.key, r16);
    const s19 = o13.symbolizerParameters.symbolTileSize;
    o13.symbolizerParameters = i13;
    const l4 = (_a = o13.rawPixelData) == null ? void 0 : _a.pixelBlock;
    return null != l4 && s19 !== r16 && (o13.source = this._sampleVectorFieldData(l4, o13.symbolizerParameters, o13.offset)), Promise.resolve();
  }
  attach() {
    super.attach(), this.container = new o12(this._tileInfoView), this.container.isCustomTilingScheme = this._isCustomTilingScheme, this._updateSymbolType(this.layer.renderer), this._handle = d(() => this.layer.renderer, (e17) => this._updateSymbolType(e17));
  }
  detach() {
    var _a;
    super.detach(), this.container.removeAllChildren(), (_a = this._handle) == null ? void 0 : _a.remove(), this._handle = null, this.container = null;
  }
  _getTileSymbolOffset(e17, t6) {
    const i13 = e17.col * this._tileInfoView.tileInfo.size[0] % t6, r16 = e17.row * this._tileInfoView.tileInfo.size[1] % t6;
    return [i13 > t6 / 2 ? t6 - i13 : -i13, r16 > t6 / 2 ? t6 - r16 : -r16];
  }
  _sampleVectorFieldData(e17, t6, i13) {
    const { symbolTileSize: r16 } = t6;
    return S(e17, "vector-uv", r16, i13);
  }
  _updateSymbolType(e17) {
    "vector-field" === (e17 == null ? void 0 : e17.type) && (this.container.symbolTypes = "wind-barb" === e17.style ? ["scalar", "triangle"] : "simple-scalar" === e17.style ? ["scalar"] : ["triangle"]);
  }
};
r([m()], a22.prototype, "container", void 0), r([m()], a22.prototype, "layer", void 0), r([m()], a22.prototype, "type", void 0), a22 = r([a("esri.views.2d.layers.imagery.VectorFieldTileView2D")], a22);
var n25 = a22;

// node_modules/@arcgis/core/views/layers/ImageryTileLayerView.js
var y3 = (y4) => {
  let f3 = class extends y4 {
    constructor() {
      super(...arguments), this.layer = null, this.tileInfo = null;
    }
    get fullExtent() {
      try {
        return this.layer.loaded ? this._getFullExtent() : null;
      } catch {
        return null;
      }
    }
    get timeExtent() {
      var _a;
      return i5(this.layer, (_a = this.view) == null ? void 0 : _a.timeExtent, this._get("timeExtent"));
    }
    get hasTilingEffects() {
      return !!(this.layer.renderer && "dynamicRangeAdjustment" in this.layer.renderer && this.layer.renderer.dynamicRangeAdjustment);
    }
    get datumTransformation() {
      try {
        return this.layer.loaded ? _(this.layer.fullExtent, this.view.spatialReference, true) : null;
      } catch {
        return null;
      }
    }
    supportsSpatialReference(e17) {
      try {
        return !this.layer.loaded || !!xe(this.layer.serviceRasterInfo, e17);
      } catch {
        return false;
      }
    }
    async fetchPopupFeaturesAtLocation(e17, i13) {
      var _a, _b;
      const { layer: s19 } = this;
      if (!e17) throw new s("imageryTileLayerView:fetchPopupFeatures", "Nothing to fetch without area", { layer: s19 });
      const { popupEnabled: l4 } = s19, u4 = p3(s19, i13);
      if (!l4 || null == u4) return [];
      const c5 = [], { value: p6, magdirValue: y5, processedValue: f4 } = await s19.identify(e17, { timeExtent: this.timeExtent, signal: i13 == null ? void 0 : i13.signal });
      let d4 = "";
      if (p6 == null ? void 0 : p6.length) {
        d4 = "imagery-tile" === s19.type && s19.hasStandardTime() && null != p6[0] ? p6.map((e19) => s19.getStandardTimeValue(e19)).join(", ") : p6.join(", ");
        const e18 = { ObjectId: 0 };
        e18[t2.servicePixelValue] = "imagery-tile" === s19.type && "Function" === s19.raster.datasetFormat ? f4 == null ? void 0 : f4.join(", ") : d4, e18[t2.rawServicePixelValue] = d4;
        const r16 = ((_a = s19.raster) == null ? void 0 : _a.rasterInfo) ?? s19.serviceRasterInfo, i14 = r16 == null ? void 0 : r16.attributeTable;
        if (null != i14) {
          const { fields: t6, features: r17 } = i14, s20 = t6.find(({ name: e19 }) => "value" === e19.toLowerCase()), n26 = e18[t2.servicePixelValue], l6 = s20 ? r17.find((e19) => String(e19.attributes[s20.name]) === n26) : null;
          if (l6) {
            for (const i15 in l6.attributes) if (l6.attributes.hasOwnProperty(i15)) {
              e18[n3 + i15] = l6.attributes[i15];
            }
          }
        }
        const l5 = r16 == null ? void 0 : r16.dataType;
        if ("vector-magdir" !== l5 && "vector-uv" !== l5 || (e18[t2.magnitude] = y5 == null ? void 0 : y5[0], e18[t2.direction] = y5 == null ? void 0 : y5[1]), "imagery-tile" === s19.type) {
          const { multidimensionalDefinition: t6 } = this.layer.normalizeRasterFetchOptions({ timeExtent: this.timeExtent });
          V(s19.rasterFields, e18, t6);
        }
        const u5 = new b3({ geometry: (_b = this.fullExtent) == null ? void 0 : _b.clone(), attributes: e18, layer: s19, sourceLayer: s19 });
        c5.push(u5);
      }
      return c5;
    }
    async getSourceScale() {
      return await this.layer.load(), O2(this.layer.serviceRasterInfo, this.view.spatialReference);
    }
    _getFullExtent() {
      return xe(this.layer.serviceRasterInfo, this.view.spatialReference);
    }
  };
  return r([m()], f3.prototype, "fullExtent", null), r([m()], f3.prototype, "layer", void 0), r([m({ readOnly: true })], f3.prototype, "timeExtent", null), r([m()], f3.prototype, "tileInfo", void 0), r([m({ readOnly: true })], f3.prototype, "hasTilingEffects", null), r([m()], f3.prototype, "datumTransformation", null), f3 = r([a("esri.views.layers.ImageryTileLayerView")], f3), f3;
};

// node_modules/@arcgis/core/views/2d/layers/ImageryTileLayerView2D.js
var b4 = class extends y3(i4(S2(y))) {
  constructor() {
    super(...arguments), this._useWebGLForProcessing = true, this._useProgressiveUpdate = true, this.subview = null;
  }
  get useWebGLForProcessing() {
    return this._useWebGLForProcessing;
  }
  set useWebGLForProcessing(e17) {
    this._useWebGLForProcessing = e17, this.subview && "useWebGLForProcessing" in this.subview && (this.subview.useWebGLForProcessing = e17);
  }
  get useProgressiveUpdate() {
    return this._useWebGLForProcessing;
  }
  set useProgressiveUpdate(e17) {
    this._useProgressiveUpdate = e17, this.subview && "useProgressiveUpdate" in this.subview && (this.subview.useProgressiveUpdate = e17);
  }
  get displayParameters() {
    const { layer: e17 } = this, s19 = this._get("displayParameters");
    return e17.renderer && e17.visible ? { bandIds: e17.bandIds, renderer: e17.renderer, interpolation: e17.interpolation, multidimensionalDefinition: e17.multidimensionalDefinition, rasterFunction: "imagery-tile" === e17.type ? e17.rasterFunction : null } : s19;
  }
  update(e17) {
    var _a;
    (_a = this.subview) == null ? void 0 : _a.update(e17), this.notifyChange("updating");
  }
  isUpdating() {
    return !this.subview || this.subview.updating;
  }
  attach() {
    this.layer.increaseRasterJobHandlerUsage(), this._updateSubview(), this.addAttachHandles([d(() => this.displayParameters, (e17, t6) => {
      const r16 = e17.interpolation !== (t6 == null ? void 0 : t6.interpolation) && ("majority" === e17.interpolation || "majority" === (t6 == null ? void 0 : t6.interpolation)) && p4(this.layer), o13 = e17.renderer !== (t6 == null ? void 0 : t6.renderer) && this._getSubviewType(t6 == null ? void 0 : t6.renderer) !== this._getSubviewType(e17.renderer);
      o13 && this._updateSubview();
      const a23 = e17.multidimensionalDefinition !== (t6 == null ? void 0 : t6.multidimensionalDefinition), n26 = e17.rasterFunction !== (t6 == null ? void 0 : t6.rasterFunction), u4 = n26 && !this._useWebGLForProcessing, h6 = a23 || r16 || o13 || u4;
      this.subview.redrawOrRefetch({ refetch: h6, reprocess: n26 }).catch((e18) => {
        b(e18) || n.getLogger(this).error(e18);
      }), this.notifyChange("updating");
    }), d(() => this.layer.multidimensionalSubset ?? null, (e17, t6) => {
      const { multidimensionalDefinition: r16 } = this.layer;
      null != r16 && o2(r16, e17) !== o2(r16, t6) && (this.subview.redrawOrRefetch({ refetch: true }).catch((e18) => {
        b(e18) || n.getLogger(this).error(e18);
      }), this.notifyChange("updating"));
    }, C), d(() => this.timeExtent, () => {
      this.subview.timeExtent = this.timeExtent, this.subview.redrawOrRefetch({ refetch: true }).catch((e17) => {
        b(e17) || n.getLogger(this).error(e17);
      });
    }, P)]);
  }
  detach() {
    var _a;
    this.layer.decreaseRasterJobHandlerUsage(), this._detachSubview(this.subview), (_a = this.subview) == null ? void 0 : _a.destroy(), this.subview = null;
  }
  viewChange() {
    this.requestUpdate();
  }
  moveEnd() {
    this.subview.moveEnd();
  }
  doRefresh() {
    return this.subview ? this.subview.doRefresh() : Promise.resolve();
  }
  _updateSubview() {
    var _a;
    const { renderer: e17 } = this.layer;
    if (!e17) return;
    const s19 = this._getSubviewType(e17);
    if (this.subview) {
      if (this.subview.type === s19) return void this._attachSubview(this.subview);
      this._detachSubview(this.subview), (_a = this.subview) == null ? void 0 : _a.destroy(), this.subview = null;
    }
    const { layer: i13 } = this;
    let t6;
    if (t6 = "rasterVF" === s19 ? new n25({ layer: i13, layerView: this, scheduler: this.scheduler }) : "flow" === s19 ? new d2({ layer: i13, layerView: this, scheduler: this.scheduler }) : new l3({ layer: i13, layerView: this, scheduler: this.scheduler }), "useWebGLForProcessing" in t6 && (t6.useWebGLForProcessing = this._useWebGLForProcessing), "useProgressiveUpdate" in t6 && (t6.useProgressiveUpdate = this._useProgressiveUpdate), "previousLOD" in t6) {
      const { subview: e18 } = this;
      t6.previousLOD = e18 && "previousLOD" in e18 ? e18.previousLOD : null;
    }
    this._attachSubview(t6), this.subview = t6, this.requestUpdate();
  }
  _attachSubview(e17) {
    e17 && !e17.attached && (e17.attach(), e17.attached = true, this.container.addChildAt(e17.container, 0));
  }
  _detachSubview(e17) {
    (e17 == null ? void 0 : e17.attached) && (this.container.removeChild(e17.container), e17.detach(), e17.attached = false);
  }
  _getSubviewType(e17) {
    const s19 = e17 == null ? void 0 : e17.type;
    return "vector-field" === s19 ? "rasterVF" : "flow" === s19 ? "flow" : "raster";
  }
};
r([m()], b4.prototype, "subview", void 0), r([m()], b4.prototype, "useWebGLForProcessing", null), r([m()], b4.prototype, "useProgressiveUpdate", null), r([m({ readOnly: true })], b4.prototype, "displayParameters", null), b4 = r([a("esri.views.2d.layers.ImageryTileLayerView2D")], b4);
var g6 = b4;
export {
  g6 as default
};
//# sourceMappingURL=ImageryTileLayerView2D-6EPQQ32Y.js.map
