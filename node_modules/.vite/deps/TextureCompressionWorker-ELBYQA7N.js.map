{
  "version": 3,
  "sources": ["../../@arcgis/core/libs/basisu/BasisUEncoder.js", "../../@arcgis/core/libs/dxtEncoder/DXTEncoder.js", "../../@arcgis/core/views/3d/webgl-engine/lib/TextureCompressionWorker.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as s}from\"../../assets.js\";function i(){return t??=(async()=>{const i=await import(\"../../chunks/basis_encoder.js\"),t=await i.default({locateFile:i=>s(`esri/libs/basisu/${i}`)});return t.initializeBasis(),t})(),t}let t;export{i as getBasisEncoder};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as t}from\"../../assets.js\";function e(){return r??=(async()=>{const e=await import(\"../../chunks/dxt_encoder.js\");return await e.default({locateFile:e=>t(`esri/libs/dxtEncoder/${e}`)})})(),r}let r;export{e as getDXTEncoder};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{getBasisEncoder as e}from\"../../../../libs/basisu/BasisUEncoder.js\";import{TextureFormat as t}from\"../../../../libs/basisu/TextureFormat.js\";import{getDXTEncoder as n}from\"../../../../libs/dxtEncoder/DXTEncoder.js\";import{CompressedTextureFormat as r}from\"../../../webgl/enums.js\";let s,a,l=null,i=null;class o{constructor(e,t){this.internalFormat=e,this.compressedTexture=t}}async function c(e){const t=m(e.data,e.flipped);if(e.hasS3TC){i||await f();const n=new Uint8Array(t.length);i?.encode(new Uint8Array(t),e.width,e.height,n);const r=R(n,!0),s=[n.buffer];return{result:new o(r?.internalFormat??null,r?.textureData??null),transferList:s}}if(e.hasETC){l||await u();const n=await h(t,e.width,e.height,e.hasMipmap),r=n?await d(n):null,s=r?.compressedTexture?.levels.map((e=>e.buffer))||[];return{result:new o(r?.internalFormat??null,r?.compressedTexture??null),transferList:s}}return{result:new o(null,null)}}async function u(){l||(l=await(s??=e()))}async function f(){i||(i=await(a??=n()))}async function h(e,t,n,r,s=255,a=0,i=!1,o=!1){if(!l)return null;const c=new l.BasisEncoder;c.setPerceptual(!o),c.setCheckForAlpha(!0),c.setForceAlpha(!1),c.setRenormalize(o),c.setMipGen(r),c.setMipSRGB(!o),c.setCreateKTX2File(!0),c.setKTX2SRGBTransferFunc(!o),c.setQualityLevel(s),c.setCompressionLevel(a);const u=new Uint8Array(e.byteLength);c.setSliceSourceImage(0,new Uint8Array(e),t,n,i);const f=c.encode(u),h=new Uint8Array(u.buffer,0,f),d=new l.KTX2File(new Uint8Array(h));return d.isValid()?(c.delete(),h):(d.close(),d.delete(),c.delete(),null)}async function d(e){if(!l)return new o(null,null);const n=new l.KTX2File(new Uint8Array(e));n.startTranscoding();const[s,a]=n.getHasAlpha()?[t.ETC2_RGBA,r.COMPRESSED_RGBA8_ETC2_EAC]:[t.ETC1_RGB,r.COMPRESSED_RGB8_ETC2],i=n.getLevels(),c=[];for(let t=0;t<i;t++)c.push(new Uint8Array(n.getImageTranscodedSizeInBytes(t,0,0,s))),n.transcodeImage(c[t],t,0,0,s,0,-1,-1);return n.close(),n.delete(),{internalFormat:a,compressedTexture:{type:\"compressed\",levels:c}}}function m(e,t=!1){const n=new OffscreenCanvas(e.width,e.height),r=n.getContext(\"2d\");t&&r.scale(1,-1),r.drawImage(e,0,t?-e.height:0);return r.getImageData(0,0,n.width,n.height).data}const w=31,T=1,p=2,C=3,E=4,y=7,A=21,g=131072;function S(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const _=S(\"DXT1\"),b=S(\"DXT3\"),D=S(\"DXT5\");function R(e,t){const n=new Int32Array(e.buffer,e.byteOffset,w);let s,a;switch(n[A]){case _:s=8,a=r.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case b:s=16,a=r.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case D:s=16,a=r.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}let l=1,i=n[E],o=n[C];(3&i||3&o)&&(i=i+3&-4,o=o+3&-4);const c=i,u=o;let f,h;n[p]&g&&!1!==t&&(l=Math.max(1,n[y]));let d=e.byteOffset+n[T]+4;const m=[];for(let r=0;r<l;++r)h=(i+3>>2)*(o+3>>2)*s,f=new Uint8Array(e.buffer,d,h),m.push(f),d+=h,i=Math.max(1,i>>1),o=Math.max(1,o>>1);return{textureData:{type:\"compressed\",levels:m},internalFormat:a,width:c,height:u}}export{o as TextureCompressionWorkerOutput,c as compress,h as compressRGBADataToKTX2,d as createTextureDataKTX2,u as initializeBasisEncoder,f as initializeDXTEncoder};\n"],
  "mappings": "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",
  "names": ["i", "t", "e", "i", "e", "t", "c", "n", "r", "s", "a", "o", "u", "f", "h", "d", "_", "l", "m"]
}
