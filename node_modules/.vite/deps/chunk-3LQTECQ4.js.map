{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{translate as e}from\"../../../../../core/libs/gl-matrix-2/math/mat4.js\";import{create as s}from\"../../../../../core/libs/gl-matrix-2/factories/mat4f64.js\";import{t as i,g as a,d as l,i as c}from\"../../../../../chunks/vec32.js\";import{ZEROS as n,create as o}from\"../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{Float3DrawUniform as r}from\"../shaderModules/Float3DrawUniform.js\";import{Float3PassUniform as t}from\"../shaderModules/Float3PassUniform.js\";import{glsl as f}from\"../shaderModules/glsl.js\";import{NoParameters as d}from\"../../../../webgl/NoParameters.js\";class u extends d{constructor(e){super(),this.slicePlaneLocalOrigin=e}}function P(e,s){B(e,s,new t(\"slicePlaneOrigin\",((e,i)=>h(s,e,i))),new t(\"slicePlaneBasis1\",((e,i)=>y(s,e,i,i.slicePlane?.basis1))),new t(\"slicePlaneBasis2\",((e,i)=>y(s,e,i,i.slicePlane?.basis2))))}function p(e,s){B(e,s,new r(\"slicePlaneOrigin\",((e,i)=>h(s,e,i))),new r(\"slicePlaneBasis1\",((e,i)=>y(s,e,i,i.slicePlane?.basis1))),new r(\"slicePlaneBasis2\",((e,i)=>y(s,e,i,i.slicePlane?.basis2))))}function m(e,s){v(e,s,new r(\"slicePlaneOrigin\",((e,i)=>h(s,e,i))),new r(\"slicePlaneBasis1\",((e,i)=>y(s,e,i,i.slicePlane?.basis1))),new r(\"slicePlaneBasis2\",((e,i)=>y(s,e,i,i.slicePlane?.basis2))))}const b=f`struct SliceFactors {\nfloat front;\nfloat side0;\nfloat side1;\nfloat side2;\nfloat side3;\n};\nSliceFactors calculateSliceFactors(vec3 pos) {\nvec3 rel = pos - slicePlaneOrigin;\nvec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\nfloat slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\nfloat basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\nfloat basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\nfloat basis1Dot = dot(slicePlaneBasis1, rel);\nfloat basis2Dot = dot(slicePlaneBasis2, rel);\nreturn SliceFactors(\ndot(slicePlaneNormal, pos) + slicePlaneW,\n-basis1Dot - basis1Len2,\nbasis1Dot - basis1Len2,\n-basis2Dot - basis2Len2,\nbasis2Dot - basis2Len2\n);\n}\nbool sliceByFactors(SliceFactors factors) {\nreturn factors.front < 0.0\n&& factors.side0 < 0.0\n&& factors.side1 < 0.0\n&& factors.side2 < 0.0\n&& factors.side3 < 0.0;\n}\nbool sliceEnabled() {\nreturn dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;\n}\nbool sliceByPlane(vec3 pos) {\nreturn sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));\n}\nbool rejectBySlice(vec3 pos) {\nreturn sliceByPlane(pos);\n}`;function v(e,s,...i){s.hasSlicePlane?(e.uniforms.add(...i),e.code.add(b)):e.code.add(\"bool rejectBySlice(vec3 pos) { return false; }\")}function B(e,s,...i){v(e,s,...i),s.hasSlicePlane?e.code.add(\"\\n    void discardBySlice(vec3 pos) {\\n      if (sliceByPlane(pos)) {\\n        discard;\\n      }\\n    }\\n\\n    vec4 applySliceOutline(vec4 color, vec3 pos) {\\n      SliceFactors factors = calculateSliceFactors(pos);\\n\\n      factors.front /= 2.0 * fwidth(factors.front);\\n      factors.side0 /= 2.0 * fwidth(factors.side0);\\n      factors.side1 /= 2.0 * fwidth(factors.side1);\\n      factors.side2 /= 2.0 * fwidth(factors.side2);\\n      factors.side3 /= 2.0 * fwidth(factors.side3);\\n\\n      // return after calling fwidth, to avoid aliasing caused by discontinuities in the input to fwidth\\n      if (sliceByFactors(factors)) {\\n        return color;\\n      }\\n\\n      float outlineFactor = (1.0 - step(0.5, factors.front))\\n        * (1.0 - step(0.5, factors.side0))\\n        * (1.0 - step(0.5, factors.side1))\\n        * (1.0 - step(0.5, factors.side2))\\n        * (1.0 - step(0.5, factors.side3));\\n\\n      return mix(color, vec4(vec3(0.0), color.a), outlineFactor * 0.3);\\n    }\\n\\n    vec4 applySlice(vec4 color, vec3 pos) {\\n      return sliceEnabled() ? applySliceOutline(color, pos) : color;\\n    }\\n  \"):e.code.add(f`void discardBySlice(vec3 pos) { }\nvec4 applySlice(vec4 color, vec3 pos) { return color; }`)}function w(e,s,i){return e.instancedDoublePrecision?c(F,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):s.slicePlaneLocalOrigin}function S(e,s){return null!=e?l(x,s.origin,e):s.origin}function g(s,i,a){return s.hasSliceTranslatedView?null!=i?e(O,a.camera.viewMatrix,i):a.camera.viewMatrix:null}function h(e,s,a){if(null==a.slicePlane)return n;const l=w(e,s,a),c=S(l,a.slicePlane),o=g(e,l,a);return null!=o?i(x,c,o):c}function y(e,s,c,o){if(null==o||null==c.slicePlane)return n;const r=w(e,s,c),t=S(r,c.slicePlane),f=g(e,r,c);return null!=f?(a(j,o,t),i(x,t,f),i(j,j,f),l(j,j,x)):o}const F=o(),x=o(),j=o(),O=s();export{m as RejectBySlice,p as SliceDraw,P as SlicePass,u as SlicePlaneParameters};\n"],
  "mappings": "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",
  "names": ["e", "o", "i", "n", "c"]
}
