{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl.js", "../../@arcgis/core/views/3d/webgl-engine/effects/ssao/SSAOBlurTechnique.js", "../../@arcgis/core/views/3d/webgl-engine/effects/ssao/SSAONoiseData.js", "../../@arcgis/core/views/3d/webgl-engine/effects/ssao/SSAOParameters.js", "../../@arcgis/core/views/3d/webgl-engine/effects/ssao/SSAOTechnique.js", "../../@arcgis/core/views/3d/webgl-engine/effects/ssao/SSAO.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{ShaderOutput as t}from\"../ShaderOutput.js\";import{Rgba4FloatEncoding as a}from\"../util/RgbaFloat16Encoding.glsl.js\";import{glsl as o}from\"../../shaderModules/glsl.js\";function e(e,l){switch(l.output){case t.Shadow:case t.ShadowHighlight:case t.ShadowExcludeHighlight:case t.ViewshedShadow:e.fragment.include(a),e.fragment.code.add(o`float _calculateFragDepth(const in float depth) {\nconst float SLOPE_SCALE = 2.0;\nconst float BIAS = 20.0 * .000015259;\nfloat m = max(abs(dFdx(depth)), abs(dFdy(depth)));\nreturn depth + SLOPE_SCALE * m + BIAS;\n}\nvoid outputDepth(float _linearDepth) {\nfragColor = floatToRgba4(_calculateFragDepth(_linearDepth));\n}`)}}export{e as OutputDepth};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{ReloadableShaderModule as e}from\"../../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as r}from\"../../core/shaderTechnique/ShaderTechnique.js\";import{S as o}from\"../../../../../chunks/SSAOBlur.glsl.js\";import{makePipelineState as s,defaultColorWrite as i}from\"../../../../webgl/renderState.js\";class l extends r{constructor(r,s){super(r,s,new e(o,(()=>import(\"../../shaders/SSAOBlur.glsl.js\"))))}initializePipeline(){return s({colorWrite:i})}}export{l as SSAOBlurTechnique};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nconst e=\"eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM\";export{e as noiseData};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{create as s}from\"../../../../../core/libs/gl-matrix-2/factories/vec2f64.js\";import{NoParameters as e}from\"../../../../webgl/NoParameters.js\";class r extends e{constructor(){super(...arguments),this.projScale=1}}class t extends r{constructor(){super(...arguments),this.intensity=1}}class o extends e{}class c extends o{constructor(){super(...arguments),this.blurSize=s()}}export{c as BlurDrawParameters,r as BlurPassParameters,o as SSAODrawParameters,t as SSAOPassParameters};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{ReloadableShaderModule as e}from\"../../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as r}from\"../../core/shaderTechnique/ShaderTechnique.js\";import{S as o}from\"../../../../../chunks/SSAO.glsl.js\";import{makePipelineState as s,defaultColorWrite as i}from\"../../../../webgl/renderState.js\";class t extends r{constructor(r,s){super(r,s,new e(o,(()=>import(\"../../shaders/SSAO.glsl.js\"))))}initializePipeline(){return s({colorWrite:i})}}export{t as SSAOTechnique};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import{clamp as r}from\"../../../../../core/mathUtils.js\";import{disposeMaybe as s}from\"../../../../../core/maybe.js\";import{watch as t}from\"../../../../../core/reactiveUtils.js\";import{Milliseconds as i}from\"../../../../../core/time.js\";import{property as o}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/has.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/RandomLCG.js\";import{subclass as a}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{set as m}from\"../../../../../core/libs/gl-matrix-2/math/vec2.js\";import{InternalRenderCategory as n}from\"../../../webgl.js\";import{ColorFormat as p}from\"../../../webgl/formats.js\";import c from\"../../../webgl/RenderNode.js\";import{distanceFadeEnd as h,distanceFadeStart as u}from\"../../core/shaderLibrary/shading/ScreenSpaceConstants.js\";import{SSAOBlurTechnique as l}from\"./SSAOBlurTechnique.js\";import{noiseData as d}from\"./SSAONoiseData.js\";import{SSAOPassParameters as f,BlurDrawParameters as b}from\"./SSAOParameters.js\";import{SSAOTechnique as w}from\"./SSAOTechnique.js\";import{RenderRequestType as T}from\"../../lib/basicInterfaces.js\";import{g as S}from\"../../../../../chunks/SSAO.glsl.js\";import{TextureWrapMode as _,PixelFormat as P,DepthStencilAttachment as j,FramebufferBit as g}from\"../../../../webgl/enums.js\";import{Texture as x}from\"../../../../webgl/Texture.js\";import{TextureDescriptor as q}from\"../../../../webgl/TextureDescriptor.js\";const A=2;let E=class extends c{constructor(e){super(e),this.consumes={required:[\"normals\"]},this.produces=n.SSAO,this.isEnabled=()=>!1,this._enableTime=i(0),this._passParameters=new f,this._drawParameters=new b}initialize(){const e=Uint8Array.from(atob(d),(e=>e.charCodeAt(0))),r=new q;r.wrapMode=_.CLAMP_TO_EDGE,r.pixelFormat=P.RGB,r.wrapMode=_.REPEAT,r.hasMipmap=!0,r.width=32,r.height=32,this._passParameters.noiseTexture=new x(this.renderingContext,r,e),this.techniques.precompile(w),this.techniques.precompile(l),this.addHandles(t((()=>this.isEnabled()),(()=>this._enableTime=i(0))))}destroy(){this._passParameters.noiseTexture=s(this._passParameters.noiseTexture)}render(e){const s=this.bindParameters,t=e.find((({name:e})=>\"normals\"===e)),o=t?.getTexture(),a=t?.getTexture(j),c=this.fboCache,d=s.camera,f=d.fullViewport[2],b=d.fullViewport[3],_=Math.round(f/A),P=Math.round(b/A),x=this.techniques.get(w),q=this.techniques.get(l);if(!x.compiled||!q.compiled)return this._enableTime=i(performance.now()),this.requestRender(T.UPDATE),c.acquire(_,P,n.SSAO,p.RED);0===this._enableTime&&(this._enableTime=i(performance.now()));const E=this.renderingContext,y=this.view.qualitySettings.fadeDuration,R=d.relativeElevation,v=r((h-R)/(h-u),0,1),C=y>0?Math.min(y,performance.now()-this._enableTime)/y:1,D=C*v;this._passParameters.normalTexture=o,this._passParameters.depthTexture=a,this._passParameters.projScale=1/d.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*O/S(d)**6*D;const V=c.acquire(f,b,\"ssao input\",p.RG);E.bindFramebuffer(V.fbo),E.setViewport(0,0,f,b),E.bindTechnique(x,s,this._passParameters,this._drawParameters),E.screen.draw();const M=c.acquire(_,P,\"ssao blur\",p.RED);E.bindFramebuffer(M.fbo),this._drawParameters.colorTexture=V.getTexture(),m(this._drawParameters.blurSize,0,A/b),E.bindTechnique(q,s,this._passParameters,this._drawParameters),E.setViewport(0,0,_,P),E.screen.draw(),V.release();const L=c.acquire(_,P,n.SSAO,p.RED);return E.bindFramebuffer(L.fbo),E.setViewport(0,0,f,b),E.setClearColor(1,1,1,0),E.clear(g.COLOR),this._drawParameters.colorTexture=M.getTexture(),m(this._drawParameters.blurSize,A/f,0),E.bindTechnique(q,s,this._passParameters,this._drawParameters),E.setViewport(0,0,_,P),E.screen.draw(),E.setViewport4fv(d.fullViewport),M.release(),C<1&&this.requestRender(T.UPDATE),L}};e([o()],E.prototype,\"consumes\",void 0),e([o()],E.prototype,\"produces\",void 0),e([o({constructOnly:!0})],E.prototype,\"isEnabled\",void 0),E=e([a(\"esri.views.3d.webgl-engine.effects.ssao.SSAO\")],E);const O=.5;export{E as SSAO,A as blurSizePixels};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{glsl as e}from\"../../shaderModules/glsl.js\";import{Texture2DBindUniform as s}from\"../../shaderModules/Texture2DBindUniform.js\";import{blurSizePixels as r}from\"../../../effects/ssao/SSAO.js\";function t(t,o){const n=t.fragment;o.receiveAmbientOcclusion?(n.uniforms.add(new s(\"ssaoTex\",(e=>e.ssao?.getTexture()))),n.constants.add(\"blurSizePixelsInverse\",\"float\",1/r),n.code.add(e`float evaluateAmbientOcclusionInverse() {\nvec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));\nreturn texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;\n}\nfloat evaluateAmbientOcclusion() {\nreturn 1.0 - evaluateAmbientOcclusionInverse();\n}`)):n.code.add(e`float evaluateAmbientOcclusionInverse() { return 1.0; }\nfloat evaluateAmbientOcclusion() { return 0.0; }`)}export{t as EvaluateAmbientOcclusion};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{colorGamma as i}from\"../../../../../../colorUtils.js\";import{neverReached as n}from\"../../../../../../core/compilerUtils.js\";import{EvaluateAmbientLighting as e}from\"./EvaluateAmbientLighting.glsl.js\";import{EvaluateAmbientOcclusion as o}from\"./EvaluateAmbientOcclusion.glsl.js\";import{addMainLightDirection as t,addMainLightIntensity as a,applyShading as r}from\"./MainLighting.glsl.js\";import{PhysicallyBasedRendering as l}from\"./PhysicallyBasedRendering.glsl.js\";import{PBRMode as c}from\"./PhysicallyBasedRenderingParameters.glsl.js\";import{PiUtils as d}from\"./PiUtils.glsl.js\";import{BooleanBindUniform as s}from\"../../shaderModules/BooleanBindUniform.js\";import{FloatBindUniform as m}from\"../../shaderModules/FloatBindUniform.js\";import{glsl as g}from\"../../shaderModules/glsl.js\";import{ambientBoost as h}from\"../../../lighting/SceneLighting.js\";function u(i){i.constants.add(\"ambientBoostFactor\",\"float\",h)}function p(i){i.uniforms.add(new m(\"lightingGlobalFactor\",(i=>i.lighting.globalFactor)))}function v(h,v){const f=h.fragment;switch(h.include(o,v),v.pbrMode!==c.Disabled&&h.include(l,v),h.include(e,v),h.include(d),f.code.add(g`\n    const float GAMMA_SRGB = ${g.float(i)};\n    const float INV_GAMMA_SRGB = 0.4761904;\n    ${v.pbrMode===c.Disabled?\"\":\"const vec3 GROUND_REFLECTANCE = vec3(0.2);\"}\n  `),u(f),p(f),t(f),f.code.add(g`\n    float additionalDirectedAmbientLight(vec3 vPosWorld) {\n      float vndl = dot(${v.spherical?g`normalize(vPosWorld)`:g`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);\n      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n    }\n  `),a(f),f.code.add(g`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\nfloat additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);\nreturn (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;\n}`),v.pbrMode){case c.Disabled:case c.WaterOnIntegratedMesh:case c.Water:h.include(r),f.code.add(g`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\nvec3 mainLighting = applyShading(normalWorld, shadow);\nvec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);\nvec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\nvec3 totalLight = mainLighting + ambientLighting + additionalLight;\ntotalLight = min(totalLight, vec3(PI));\nvec3 outColor = vec3((albedoLinear / PI) * totalLight);\nreturn pow(outColor, vec3(INV_GAMMA_SRGB));\n}`);break;case c.Normal:case c.Schematic:f.code.add(g`const float fillLightIntensity = 0.25;\nconst float horizonLightDiffusion = 0.4;\nconst float additionalAmbientIrradianceFactor = 0.02;\nvec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec4 _emission, float additionalAmbientIrradiance)\n{\nvec3 viewDirection = -viewDir;\nvec3 h = normalize(viewDirection + mainLightDirection);\nPBRShadingInfo inputs;\ninputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\ninputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);\nvec3 reflectedView = normalize(reflect(viewDirection, normal));\ninputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);\ninputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\ninputs.ssao = ssao;\ninputs.metalness = mrr[0];\ninputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),f.code.add(g`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\ninputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));\ninputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),v.useFillLights?f.uniforms.add(new s(\"hasFillLights\",(i=>i.enableFillLights))):f.constants.add(\"hasFillLights\",\"bool\",!1),f.code.add(g`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\nambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\ninputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;\nfloat NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);\nvec3 mainLightIrradianceComponent = NdotL * (1.0 - shadow) * mainLightIntensity;\nvec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;\nvec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;\ninputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\ninputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),f.uniforms.add(new m(\"lightingSpecularStrength\",(i=>i.lighting.mainLight.specularStrength)),new m(\"lightingEnvironmentStrength\",(i=>i.lighting.mainLight.environmentStrength))).code.add(g`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;\nvec3 horizonRingH = normalize(viewDirection + horizonRingDir);\ninputs.NdotH_Horizon = dot(normal, horizonRingH);\nfloat NdotH = clamp(dot(normal, h), 0.0, 1.0);\nvec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);\nvec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;\nvec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;\nfloat normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));\ninputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;\ninputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;\ninputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),f.code.add(g`\n        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent = _emission.rgb == vec3(0.0) ? _emission.rgb : pow(_emission.rgb, vec3(GAMMA_SRGB));\n        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ${v.pbrMode!==c.Schematic||v.hasColorTexture?g`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:g`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}\n        return outColor;\n      }\n    `);break;case c.Simplified:case c.TerrainWithWater:t(f),a(f),f.code.add(g`const float roughnessTerrain = 0.5;\nconst float specularityTerrain = 0.5;\nconst vec3 fresnelReflectionTerrain = vec3(0.04);\nvec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {\nvec3 viewDirection = -vd;\nvec3 h = normalize(viewDirection + mainLightDirection);\nfloat NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);\nfloat NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);\nfloat NdotH = clamp(dot(n, h), 0.0, 1.0);\nfloat NdotNG = clamp(dot(n, nup), -1.0, 1.0);\nvec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));\nfloat lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];\nvec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;\nvec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));\nvec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;\nvec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;\nvec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;\nvec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;\nvec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;\nvec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;\nvec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);\nvec3 specularColor = f0 * dfg.x + f90 * dfg.y;\nvec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;\nvec3 outColorLinear = outDiffColor + specularComponent;\nvec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));\nreturn outColor;\n}`);break;default:n(v.pbrMode);case c.COUNT:}}export{v as EvaluateSceneLighting,u as addAmbientBoostFactor,p as addLightingGlobalFactor};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAI8K,SAASA,GAAEA,IAAEC,IAAE;AAAC,UAAOA,GAAE,QAAO;AAAA,IAAC,KAAKC,GAAE;AAAA,IAAO,KAAKA,GAAE;AAAA,IAAgB,KAAKA,GAAE;AAAA,IAAuB,KAAKA,GAAE;AAAe,MAAAF,GAAE,SAAS,QAAQG,EAAC,GAAEH,GAAE,SAAS,KAAK,IAAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQhV;AAAA,EAAC;AAAC;;;ACRiU,IAAME,KAAN,cAAgB,EAAC;AAAA,EAAC,YAAYC,IAAE,GAAE;AAAC,UAAMA,IAAE,GAAE,IAAIC,GAAE,GAAG,MAAI,OAAO,6BAAgC,CAAE,CAAC;AAAA,EAAC;AAAA,EAAC,qBAAoB;AAAC,WAAO,EAAE,EAAC,YAAW,EAAC,CAAC;AAAA,EAAC;AAAC;;;ACAzd,IAAMC,KAAE;;;ACA4I,IAAMC,KAAN,cAAgB,EAAC;AAAA,EAAC,cAAa;AAAC,UAAM,GAAG,SAAS,GAAE,KAAK,YAAU;AAAA,EAAC;AAAC;AAAC,IAAMC,KAAN,cAAgBD,GAAC;AAAA,EAAC,cAAa;AAAC,UAAM,GAAG,SAAS,GAAE,KAAK,YAAU;AAAA,EAAC;AAAC;AAAC,IAAME,KAAN,cAAgB,EAAC;AAAC;AAAC,IAAMC,KAAN,cAAgBD,GAAC;AAAA,EAAC,cAAa;AAAC,UAAM,GAAG,SAAS,GAAE,KAAK,WAASE,GAAE;AAAA,EAAC;AAAC;;;ACAxD,IAAMC,KAAN,cAAgB,EAAC;AAAA,EAAC,YAAYC,IAAE,GAAE;AAAC,UAAMA,IAAE,GAAE,IAAID,GAAEE,IAAG,MAAI,OAAO,yBAA4B,CAAE,CAAC;AAAA,EAAC;AAAA,EAAC,qBAAoB;AAAC,WAAO,EAAE,EAAC,YAAW,EAAC,CAAC;AAAA,EAAC;AAAC;;;ACAgjC,IAAM,IAAE;AAAE,IAAI,IAAE,cAAc,EAAC;AAAA,EAAC,YAAYC,IAAE;AAAC,UAAMA,EAAC,GAAE,KAAK,WAAS,EAAC,UAAS,CAAC,SAAS,EAAC,GAAE,KAAK,WAASC,GAAE,MAAK,KAAK,YAAU,MAAI,OAAG,KAAK,cAAYC,GAAE,CAAC,GAAE,KAAK,kBAAgB,IAAID,MAAE,KAAK,kBAAgB,IAAIE;AAAA,EAAC;AAAA,EAAC,aAAY;AAAC,UAAMH,KAAE,WAAW,KAAK,KAAKA,EAAC,GAAG,CAAAA,OAAGA,GAAE,WAAW,CAAC,CAAE,GAAEI,KAAE,IAAI;AAAE,IAAAA,GAAE,WAAS,EAAE,eAAcA,GAAE,cAAY,EAAE,KAAIA,GAAE,WAAS,EAAE,QAAOA,GAAE,YAAU,MAAGA,GAAE,QAAM,IAAGA,GAAE,SAAO,IAAG,KAAK,gBAAgB,eAAa,IAAI,EAAE,KAAK,kBAAiBA,IAAEJ,EAAC,GAAE,KAAK,WAAW,WAAWC,EAAC,GAAE,KAAK,WAAW,WAAWI,EAAC,GAAE,KAAK,WAAW,EAAG,MAAI,KAAK,UAAU,GAAI,MAAI,KAAK,cAAYH,GAAE,CAAC,CAAE,CAAC;AAAA,EAAC;AAAA,EAAC,UAAS;AAAC,SAAK,gBAAgB,eAAaE,GAAE,KAAK,gBAAgB,YAAY;AAAA,EAAC;AAAA,EAAC,OAAOJ,IAAE;AAAC,UAAM,IAAE,KAAK,gBAAeC,MAAED,GAAE,KAAM,CAAC,EAAC,MAAKA,GAAC,MAAI,cAAYA,EAAE,GAAEM,KAAEL,OAAA,gBAAAA,IAAG,cAAaM,KAAEN,OAAA,gBAAAA,IAAG,WAAWA,KAAGE,KAAE,KAAK,UAASK,KAAE,EAAE,QAAOC,KAAED,GAAE,aAAa,CAAC,GAAE,IAAEA,GAAE,aAAa,CAAC,GAAEE,KAAE,KAAK,MAAMD,KAAE,CAAC,GAAE,IAAE,KAAK,MAAM,IAAE,CAAC,GAAE,IAAE,KAAK,WAAW,IAAIR,EAAC,GAAE,IAAE,KAAK,WAAW,IAAII,EAAC;AAAE,QAAG,CAAC,EAAE,YAAU,CAAC,EAAE,SAAS,QAAO,KAAK,cAAYH,GAAE,YAAY,IAAI,CAAC,GAAE,KAAK,cAAcK,GAAE,MAAM,GAAEJ,GAAE,QAAQO,IAAE,GAAET,GAAE,MAAK,EAAE,GAAG;AAAE,UAAI,KAAK,gBAAc,KAAK,cAAYC,GAAE,YAAY,IAAI,CAAC;AAAG,UAAMS,KAAE,KAAK,kBAAiB,IAAE,KAAK,KAAK,gBAAgB,cAAaC,KAAEJ,GAAE,mBAAkBK,KAAE,GAAGP,KAAEM,OAAIN,KAAEN,KAAG,GAAE,CAAC,GAAE,IAAE,IAAE,IAAE,KAAK,IAAI,GAAE,YAAY,IAAI,IAAE,KAAK,WAAW,IAAE,IAAE,GAAEc,KAAE,IAAED;AAAE,SAAK,gBAAgB,gBAAcP,IAAE,KAAK,gBAAgB,eAAaC,IAAE,KAAK,gBAAgB,YAAU,IAAEC,GAAE,6BAA6B,CAAC,GAAE,KAAK,gBAAgB,YAAU,IAAE,IAAE,EAAEA,EAAC,KAAG,IAAEM;AAAE,UAAM,IAAEX,GAAE,QAAQM,IAAE,GAAE,cAAa,EAAE,EAAE;AAAE,IAAAE,GAAE,gBAAgB,EAAE,GAAG,GAAEA,GAAE,YAAY,GAAE,GAAEF,IAAE,CAAC,GAAEE,GAAE,cAAc,GAAE,GAAE,KAAK,iBAAgB,KAAK,eAAe,GAAEA,GAAE,OAAO,KAAK;AAAE,UAAM,IAAER,GAAE,QAAQO,IAAE,GAAE,aAAY,EAAE,GAAG;AAAE,IAAAC,GAAE,gBAAgB,EAAE,GAAG,GAAE,KAAK,gBAAgB,eAAa,EAAE,WAAW,GAAE,EAAE,KAAK,gBAAgB,UAAS,GAAE,IAAE,CAAC,GAAEA,GAAE,cAAc,GAAE,GAAE,KAAK,iBAAgB,KAAK,eAAe,GAAEA,GAAE,YAAY,GAAE,GAAED,IAAE,CAAC,GAAEC,GAAE,OAAO,KAAK,GAAE,EAAE,QAAQ;AAAE,UAAM,IAAER,GAAE,QAAQO,IAAE,GAAET,GAAE,MAAK,EAAE,GAAG;AAAE,WAAOU,GAAE,gBAAgB,EAAE,GAAG,GAAEA,GAAE,YAAY,GAAE,GAAEF,IAAE,CAAC,GAAEE,GAAE,cAAc,GAAE,GAAE,GAAE,CAAC,GAAEA,GAAE,MAAM,EAAE,KAAK,GAAE,KAAK,gBAAgB,eAAa,EAAE,WAAW,GAAE,EAAE,KAAK,gBAAgB,UAAS,IAAEF,IAAE,CAAC,GAAEE,GAAE,cAAc,GAAE,GAAE,KAAK,iBAAgB,KAAK,eAAe,GAAEA,GAAE,YAAY,GAAE,GAAED,IAAE,CAAC,GAAEC,GAAE,OAAO,KAAK,GAAEA,GAAE,eAAeH,GAAE,YAAY,GAAE,EAAE,QAAQ,GAAE,IAAE,KAAG,KAAK,cAAcD,GAAE,MAAM,GAAE;AAAA,EAAC;AAAC;AAAEH,GAAE,CAAC,EAAE,CAAC,GAAE,EAAE,WAAU,YAAW,MAAM,GAAEA,GAAE,CAAC,EAAE,CAAC,GAAE,EAAE,WAAU,YAAW,MAAM,GAAEA,GAAE,CAAC,EAAE,EAAC,eAAc,KAAE,CAAC,CAAC,GAAE,EAAE,WAAU,aAAY,MAAM,GAAE,IAAEA,GAAE,CAAC,EAAE,8CAA8C,CAAC,GAAE,CAAC;AAAE,IAAM,IAAE;;;ACApyH,SAASW,GAAEA,KAAEC,IAAE;AAAC,QAAMC,KAAEF,IAAE;AAAS,EAAAC,GAAE,2BAAyBC,GAAE,SAAS,IAAI,IAAID,GAAE,WAAW,CAAAE,OAAC;AAJpS;AAIsS,iBAAAA,GAAE,SAAF,mBAAQ;AAAA,GAAa,CAAC,GAAED,GAAE,UAAU,IAAI,yBAAwB,SAAQ,IAAE,CAAC,GAAEA,GAAE,KAAK,IAAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAM5X,KAAGA,GAAE,KAAK,IAAIA;AAAA,iDACiC;AAAC;;;ACPwyB,SAAS,EAAE,GAAE;AAAC,IAAE,UAAU,IAAI,sBAAqB,SAAQE,EAAC;AAAC;AAAC,SAASC,GAAE,GAAE;AAAC,IAAE,SAAS,IAAI,IAAI,EAAE,wBAAwB,CAAAC,OAAGA,GAAE,SAAS,YAAa,CAAC;AAAC;AAAC,SAASC,GAAEC,IAAED,IAAE;AAAC,QAAME,KAAED,GAAE;AAAS,UAAOA,GAAE,QAAQE,IAAEH,EAAC,GAAEA,GAAE,YAAUI,GAAE,YAAUH,GAAE,QAAQG,IAAEJ,EAAC,GAAEC,GAAE,QAAQI,IAAEL,EAAC,GAAEC,GAAE,QAAQE,EAAC,GAAED,GAAE,KAAK,IAAIE;AAAA,+BACzlCA,GAAE,MAAM,CAAC,CAAC;AAAA;AAAA,MAEnCJ,GAAE,YAAUI,GAAE,WAAS,KAAG,4CAA4C;AAAA,GACzE,GAAE,EAAEF,EAAC,GAAEJ,GAAEI,EAAC,GAAEC,GAAED,EAAC,GAAEA,GAAE,KAAK,IAAIE;AAAA;AAAA,yBAENJ,GAAE,YAAUI,2BAAwBA,uBAAsB;AAAA;AAAA;AAAA,GAGhF,GAAEE,GAAEJ,EAAC,GAAEA,GAAE,KAAK,IAAIE;AAAA;AAAA;AAAA,EAGnB,GAAEJ,GAAE,SAAQ;AAAA,IAAC,KAAKI,GAAE;AAAA,IAAS,KAAKA,GAAE;AAAA,IAAsB,KAAKA,GAAE;AAAM,MAAAH,GAAE,QAAQM,EAAC,GAAEL,GAAE,KAAK,IAAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQ/F;AAAE;AAAA,IAAM,KAAKA,GAAE;AAAA,IAAO,KAAKA,GAAE;AAAU,MAAAF,GAAE,KAAK,IAAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wDAeI,GAAEF,GAAE,KAAK,IAAIE;AAAA;AAAA,gGAE2B,GAAEJ,GAAE,gBAAcE,GAAE,SAAS,IAAI,IAAIM,GAAE,iBAAiB,OAAG,EAAE,gBAAiB,CAAC,IAAEN,GAAE,UAAU,IAAI,iBAAgB,QAAO,KAAE,GAAEA,GAAE,KAAK,IAAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yJAQ9E,GAAEF,GAAE,SAAS,IAAI,IAAI,EAAE,4BAA4B,OAAG,EAAE,SAAS,UAAU,gBAAiB,GAAE,IAAI,EAAE,+BAA+B,OAAG,EAAE,SAAS,UAAU,mBAAoB,CAAC,EAAE,KAAK,IAAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oGAUhP,GAAEF,GAAE,KAAK,IAAIE;AAAA;AAAA;AAAA;AAAA;AAAA,UAKvGJ,GAAE,YAAUI,GAAE,aAAWJ,GAAE,kBAAgBI,oGAAiGA,sHAAqH;AAAA;AAAA;AAAA,KAGtQ;AAAE;AAAA,IAAM,KAAKA,GAAE;AAAA,IAAW,KAAKA,GAAE;AAAiB,MAAAD,GAAED,EAAC,GAAEI,GAAEJ,EAAC,GAAEA,GAAE,KAAK,IAAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA0B1E;AAAE;AAAA,IAAM;AAAQ,QAAEJ,GAAE,OAAO;AAAA,IAAE,KAAKI,GAAE;AAAA,EAAM;AAAC;",
  "names": ["e", "l", "n", "a", "l", "r", "t", "e", "r", "t", "o", "c", "n", "t", "r", "g", "e", "t", "n", "c", "r", "l", "o", "a", "d", "f", "_", "E", "R", "v", "D", "t", "o", "n", "e", "l", "p", "i", "v", "h", "f", "t", "n", "m", "o", "a", "e"]
}
