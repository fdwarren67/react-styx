{
  "version": 3,
  "sources": ["../../@arcgis/core/symbols/cim/CIMSymbolRasterizer.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport e from\"./CIMResourceManager.js\";import{Transformation as t,CanvasDrawHelper as i}from\"./CIMSymbolDrawHelper.js\";import{CIMSymbolHelper as h}from\"./CIMSymbolHelper.js\";import{OverrideHelper as r}from\"./OverrideHelper.js\";import{scale as n,translate as s}from\"./rasterizingUtils.js\";import{mapCIMSymbolToGeometryType as a}from\"./utils.js\";const o=96/72;class l{constructor(t){this._spatialReference=t,this._imageDataCanvas=null,this._cimResourceManager=new e}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement(\"canvas\")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,s,o,l,m,g,y,d){if(!e)return null;const{data:w}=e;if(!w||\"CIMSymbolReference\"!==w.type||!w.symbol)return null;const{symbol:u}=w;l||(l=a(u));const x=await r.resolveSymbolOverrides(w,t,this._spatialReference,o,l,m,g),f=this._cimResourceManager,p=[];h.fetchResources(x,f,p),h.fetchFonts(x,f,p),p.length>0&&await Promise.all(p);const{width:b,height:M}=i;let C=c(l,b,M,s,d);const R=h.getEnvelope(x,C,f);if(!R)return null;R.x===1/0&&(R.x=b+2),R.y===1/0&&(R.y=-M/2),R.width===-1/0&&(R.width=b),R.height===-1/0&&(R.height=M);let v=1,I=0,S=0;switch(u.type){case\"CIMPointSymbol\":case\"CIMTextSymbol\":{let e=1;R.width>b&&(e=b/R.width);let t=1;R.height>M&&(t=M/R.height),\"preview\"===s&&(R.width<b&&(e=b/R.width),R.height<M&&(t=M/R.height)),v=Math.min(e,t),I=R.x+R.width/2,S=R.y+R.height/2}break;case\"CIMLineSymbol\":if(d){S=R.y+R.height/2,I=R.x+R.width/2;const e=R.width-b,t=R.height-M;C={paths:n(C.paths,{xmin:-1*R.width/2+e,xmax:R.width/2-e,ymin:-1*R.height/2+t,ymax:R.height/2-t,width:R.width-2*e,height:R.height-2*t})}}else{(y||R.height>M)&&(v=M/R.height),S=R.y+R.height/2;const e=R.x*v+b/2,t=(R.x+R.width)*v+b/2,{paths:i}=C;i[0][0][0]-=e/v,i[0][2][0]-=(t-b)/v}break;case\"CIMPolygonSymbol\":if(d){S=R.y+R.height/2,I=R.x+R.width/2;const e=R.width-b,t=R.height-M;C={paths:n(C.rings,{xmin:-1*R.width/2+e,xmax:R.width/2-e,ymin:-1*R.height/2+t,ymax:R.height/2-t,width:R.width-2*e,height:R.height-2*t})}}else{I=R.x+R.width/2,S=R.y+R.height/2;const e=R.x*v+b/2,t=(R.x+R.width)*v+b/2,i=R.y*v+M/2,h=(R.y+R.height)*v+M/2,{rings:r}=C;e<0&&(r[0][0][0]-=e,r[0][3][0]-=e,r[0][4][0]-=e),i<0&&(r[0][0][1]+=i,r[0][1][1]+=i,r[0][4][1]+=i),t>b&&(r[0][1][0]-=t-b,r[0][2][0]-=t-b),h>M&&(r[0][2][1]+=h-M,r[0][3][1]+=h-M)}}const _={type:\"cim\",data:{type:\"CIMSymbolReference\",symbol:x}};return this.rasterize(_,b,M,I,S,v,l,1,C)}rasterize(e,h,r,n,s,l,m,g=0,y=null,d=window.devicePixelRatio||1){const{data:w}=e;if(!w||\"CIMSymbolReference\"!==w.type||!w.symbol)return null;const{symbol:u}=w,x=this._canvas,f=d*o;x.width=h*f,x.height=r*f,m||(m=a(u)),y||(y=c(m,h,r,\"legend\")),x.width+=2*g,x.height+=2*g;const p=x.getContext(\"2d\",{willReadFrequently:!0}),b=t.createIdentity();b.translate(-n,-s),b.scale(l*f,-l*f),b.translate(h*f/2+g,r*f/2+g),p.clearRect(0,0,x.width,x.height);return new i(p,this._cimResourceManager,b,!0).drawSymbol(u,y),p.getImageData(0,0,x.width,x.height)}}function m(e,t,i,h){if(\"esriGeometryPolygon\"===t){return{rings:s(n(e.rings,{xmin:0,ymin:0,xmax:i,ymax:h,width:i,height:h}),-1*i/2,-1*h/2)}}if(\"esriGeometryPolyline\"===t){return{paths:s(n(e.paths,{xmin:0,ymin:0,xmax:i,ymax:h,width:i,height:h}),-1*i/2,-1*h/2)}}return null}function c(e,t,i,h,r){const n=1,s=-t/2+n,a=t/2-n,o=i/2-n,l=-i/2+n;if(r&&(\"esriGeometryPolygon\"===e||\"esriGeometryPolyline\"===e)){const h=m(r,e,t,i);if(h)return h}switch(e){case\"esriGeometryPoint\":return{x:0,y:0};case\"esriGeometryPolyline\":return{paths:[[[s,0],[0,0],[a,0]]]};default:return\"legend\"===h?{rings:[[[s,o],[a,0],[a,l],[s,l],[s,o]]]}:{rings:[[[s,o],[a,o],[a,l],[s,l],[s,o]]]}}}export{l as CIMSymbolRasterizer};\n"],
  "mappings": "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",
  "names": ["i", "o", "l", "m", "y", "R", "e", "t", "h"]
}
