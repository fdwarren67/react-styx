{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloat16Encoding.glsl.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderModules/Matrix4sDrawUniform.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderModules/Matrix4sPassUniform.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{i}from\"../../../../../../chunks/vec32.js\";import{create as n}from\"../../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{s as t}from\"../../../../../../chunks/vec42.js\";import{create as e}from\"../../../../../../core/libs/gl-matrix-2/factories/vec4f64.js\";import{PBRMode as h}from\"./PhysicallyBasedRenderingParameters.glsl.js\";import{Float3BindUniform as s}from\"../../shaderModules/Float3BindUniform.js\";import{Float4BindUniform as g}from\"../../shaderModules/Float4BindUniform.js\";import{glsl as r}from\"../../shaderModules/glsl.js\";function m(n,e){const m=n.fragment,o=void 0!==e.lightingSphericalHarmonicsOrder?e.lightingSphericalHarmonicsOrder:2;0===o?(m.uniforms.add(new s(\"lightingAmbientSH0\",(({lighting:n})=>i(l,n.sh.r[0],n.sh.g[0],n.sh.b[0])))),m.code.add(r`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec3 ambientLight = 0.282095 * lightingAmbientSH0;\nreturn ambientLight * (1.0 - ambientOcclusion);\n}`)):1===o?(m.uniforms.add(new g(\"lightingAmbientSH_R\",(({lighting:i})=>t(a,i.sh.r[0],i.sh.r[1],i.sh.r[2],i.sh.r[3]))),new g(\"lightingAmbientSH_G\",(({lighting:i})=>t(a,i.sh.g[0],i.sh.g[1],i.sh.g[2],i.sh.g[3]))),new g(\"lightingAmbientSH_B\",(({lighting:i})=>t(a,i.sh.b[0],i.sh.b[1],i.sh.b[2],i.sh.b[3])))),m.code.add(r`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec4 sh0 = vec4(\n0.282095,\n0.488603 * normal.x,\n0.488603 * normal.z,\n0.488603 * normal.y\n);\nvec3 ambientLight = vec3(\ndot(lightingAmbientSH_R, sh0),\ndot(lightingAmbientSH_G, sh0),\ndot(lightingAmbientSH_B, sh0)\n);\nreturn ambientLight * (1.0 - ambientOcclusion);\n}`)):2===o&&(m.uniforms.add(new s(\"lightingAmbientSH0\",(({lighting:n})=>i(l,n.sh.r[0],n.sh.g[0],n.sh.b[0]))),new g(\"lightingAmbientSH_R1\",(({lighting:i})=>t(a,i.sh.r[1],i.sh.r[2],i.sh.r[3],i.sh.r[4]))),new g(\"lightingAmbientSH_G1\",(({lighting:i})=>t(a,i.sh.g[1],i.sh.g[2],i.sh.g[3],i.sh.g[4]))),new g(\"lightingAmbientSH_B1\",(({lighting:i})=>t(a,i.sh.b[1],i.sh.b[2],i.sh.b[3],i.sh.b[4]))),new g(\"lightingAmbientSH_R2\",(({lighting:i})=>t(a,i.sh.r[5],i.sh.r[6],i.sh.r[7],i.sh.r[8]))),new g(\"lightingAmbientSH_G2\",(({lighting:i})=>t(a,i.sh.g[5],i.sh.g[6],i.sh.g[7],i.sh.g[8]))),new g(\"lightingAmbientSH_B2\",(({lighting:i})=>t(a,i.sh.b[5],i.sh.b[6],i.sh.b[7],i.sh.b[8])))),m.code.add(r`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec3 ambientLight = 0.282095 * lightingAmbientSH0;\nvec4 sh1 = vec4(\n0.488603 * normal.x,\n0.488603 * normal.z,\n0.488603 * normal.y,\n1.092548 * normal.x * normal.y\n);\nvec4 sh2 = vec4(\n1.092548 * normal.y * normal.z,\n0.315392 * (3.0 * normal.z * normal.z - 1.0),\n1.092548 * normal.x * normal.z,\n0.546274 * (normal.x * normal.x - normal.y * normal.y)\n);\nambientLight += vec3(\ndot(lightingAmbientSH_R1, sh1),\ndot(lightingAmbientSH_G1, sh1),\ndot(lightingAmbientSH_B1, sh1)\n);\nambientLight += vec3(\ndot(lightingAmbientSH_R2, sh2),\ndot(lightingAmbientSH_G2, sh2),\ndot(lightingAmbientSH_B2, sh2)\n);\nreturn ambientLight * (1.0 - ambientOcclusion);\n}`),e.pbrMode!==h.Normal&&e.pbrMode!==h.Schematic||m.code.add(r`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);\nvec3 calculateAmbientRadiance(float ambientOcclusion)\n{\nvec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\nreturn ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;\n}`))}const l=n(),a=e();export{m as EvaluateAmbientLighting};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{glsl as o}from\"../../shaderModules/glsl.js\";function a(a){a.code.add(o`const float MAX_RGBA4_FLOAT =\n15.0 / 16.0 +\n15.0 / 16.0 / 16.0 +\n15.0 / 16.0 / 16.0 / 16.0 +\n15.0 / 16.0 / 16.0 / 16.0 / 16.0;\nconst vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);\nvec4 floatToRgba4(const float value) {\nfloat valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);\nvec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);\nconst float toU4AsFloat = 1.0 / 15.0;\nreturn fixedPointU4 * toU4AsFloat;\n}\nconst vec4 RGBA4_2_FLOAT_FACTORS = vec4(\n15.0 / (16.0),\n15.0 / (16.0 * 16.0),\n15.0 / (16.0 * 16.0 * 16.0),\n15.0 / (16.0 * 16.0 * 16.0 * 16.0)\n);\nfloat rgba4ToFloat(vec4 rgba) {\nreturn dot(rgba, RGBA4_2_FLOAT_FACTORS);\n}`)}export{a as Rgba4FloatEncoding};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{BindType as r}from\"../../../../webgl/BindType.js\";import{Uniform as o}from\"../../../../webgl/Uniform.js\";class t extends o{constructor(o,t,e){super(o,\"mat4\",r.Draw,((r,e,s,m)=>r.setUniformMatrix4fv(o,t(e,s,m))),e)}}export{t as Matrix4sDrawUniform};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{BindType as r}from\"../../../../webgl/BindType.js\";import{Uniform as s}from\"../../../../webgl/Uniform.js\";class o extends s{constructor(s,o,t){super(s,\"mat4\",r.Pass,((r,t,e)=>r.setUniformMatrix4fv(s,o(t,e))),t)}}export{o as Matrix4sPassUniform};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{IDENTITY as e}from\"../../../../../../core/libs/gl-matrix-2/factories/mat4f64.js\";import{create as s}from\"../../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{Rgba4FloatEncoding as a}from\"../util/RgbaFloat16Encoding.glsl.js\";import{Float4BindUniform as t}from\"../../shaderModules/Float4BindUniform.js\";import{glsl as o}from\"../../shaderModules/glsl.js\";import{IntegerBindUniform as i}from\"../../shaderModules/IntegerBindUniform.js\";import{Matrix4sDrawUniform as r}from\"../../shaderModules/Matrix4sDrawUniform.js\";import{Matrix4sPassUniform as d}from\"../../shaderModules/Matrix4sPassUniform.js\";import{Texture2DBindUniform as c}from\"../../shaderModules/Texture2DBindUniform.js\";import{NoParameters as p}from\"../../../../../webgl/NoParameters.js\";class n extends p{constructor(){super(...arguments),this.origin=s()}}class l extends n{}class v extends p{constructor(){super(...arguments),this.modelTransformation=e}}class h extends v{constructor(){super(...arguments),this.origin=s()}}function m(e,s){s.receiveShadows&&(e.fragment.uniforms.add(new d(\"shadowMapMatrix\",((e,s)=>s.shadowMap.getShadowMapMatrices(e.origin)),4)),f(e))}function x(e,s){s.receiveShadows&&(e.fragment.uniforms.add(new r(\"shadowMapMatrix\",((e,s)=>s.shadowMap.getShadowMapMatrices(e.origin)),4)),f(e))}function f(e){const s=e.fragment;s.include(a),s.uniforms.add(new c(\"shadowMap\",(e=>e.shadowMap.depthTexture)),new i(\"numCascades\",(e=>e.shadowMap.numCascades)),new t(\"cascadeDistances\",(e=>e.shadowMap.cascadeDistances))).code.add(o`int chooseCascade(float depth, out mat4 mat) {\nvec4 distance = cascadeDistances;\nint i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\nmat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\nreturn i;\n}\nvec3 lightSpacePosition(vec3 _vpos, mat4 mat) {\nvec4 lv = mat * vec4(_vpos, 1.0);\nlv.xy /= lv.w;\nreturn 0.5 * lv.xyz + vec3(0.5);\n}\nvec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {\nfloat xScale = float(textureSize.y) / float(textureSize.x);\nreturn vec2((float(i) + lvpos.x) * xScale, lvpos.y);\n}\nfloat readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {\nreturn rgba4ToFloat(texelFetch(_depthTex, uv, 0));\n}\nfloat posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {\nreturn readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;\n}\nfloat filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {\nvec2 st = fract(uv * vec2(texSize) + vec2(0.5));\nivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));\nfloat s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);\nfloat s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);\nfloat s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);\nfloat s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);\nreturn mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n}\nfloat readShadowMap(const in vec3 _vpos, float _linearDepth) {\nmat4 mat;\nint i = chooseCascade(_linearDepth, mat);\nif (i >= numCascades) { return 0.0; }\nvec3 lvpos = lightSpacePosition(_vpos, mat);\nif (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\nivec2 size = textureSize(shadowMap, 0);\nvec2 uv = cascadeCoordinates(i, size, lvpos);\nreturn filterShadow(uv, lvpos, size, shadowMap);\n}`)}export{x as ReadShadowMapDraw,l as ReadShadowMapDrawParameters,v as ReadShadowMapParameters,m as ReadShadowMapPass,h as ReadShadowMapPassParameters};\n"],
  "mappings": "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",
  "names": ["n", "e", "m", "o", "i", "a", "a", "n", "o", "t", "e", "s", "m", "o", "s", "t", "e", "m", "e", "s", "o", "a", "n"]
}
