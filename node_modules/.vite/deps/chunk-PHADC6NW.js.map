{
  "version": 3,
  "sources": ["../../@arcgis/core/support/arcadeOnDemand.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{ArcadeDate as e}from\"../arcade/ArcadeDate.js\";import t from\"../core/Error.js\";import r from\"../core/Logger.js\";import s from\"../geometry/SpatialReference.js\";const i=()=>r.getLogger(\"esri.support.arcadeOnDemand\"),a=[\"geometry\",\"scale\",\"timeProperties\"];function n(e,t){if(null!=t)for(const r of a)t.hasArcadeDependency(r)&&e.add(r);return e}let c;function o(){return c||(c=(async()=>{const e=await import(\"./arcadeUtils.js\");return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature,Voxel:e.Voxel}})()),c}const l=(e,t,r)=>d.create(e,t,r,null,[\"$feature\",\"$view\"],[]),p=(e,t,r)=>d.create(e,t,r,null,[\"$feature\",\"$view\"],[]),u=(e,t,r,s)=>d.create(e,t,r,s,[\"$feature\",\"$view\"],[]);class d{constructor(e,t,r,s,i,a,n){this._dependencies=new Map,this.services=null,this.script=e,this.evaluate=s;const c=Array.isArray(a)?a:a?.fields;this.fields=c??[],this._syntaxTree=r,this._arcade=t,this._arcadeFeature=i,this._spatialReference=n,this._dependencies.set(\"geometry\",t.scriptTouchesGeometry(this._syntaxTree)),this._dependencies.set(\"scale\",this._arcade.referencesMember(this._syntaxTree,\"scale\")),this._dependencies.set(\"timeProperties\",this._arcade.scriptUsesViewProperties(this._syntaxTree,[\"timeProperties\"]))}static async create(r,a,n,c,l,p){const{arcade:u,Feature:m,Dictionary:f}=await o(),h=a instanceof s?a:s.fromJSON(a);let w;try{w=u.parseScript(r,p)}catch(j){return i().error(new t(\"arcade-bad-expression\",\"Failed to parse arcade script\",{script:r,error:j})),null}const y=l.reduce(((e,t)=>({...e,[t]:null})),{});let v=null;null!=c&&(v=new f(c),v.immutable=!0,y.$config=null);const $=u.scriptUsesGeometryEngine(w),_=$&&u.enableGeometrySupport(),g=u.scriptUsesFeatureSet(w)&&u.enableFeatureSetSupport(),F=u.scriptIsAsync(w),S=F&&u.enableAsyncSupport(),b={vars:y,spatialReference:h,useAsync:!!S};await Promise.all([_,g,S]);const A=new Set;await u.loadDependentModules(A,w,null,F,$);const D=new f;D.immutable=!1,D.setField(\"scale\",0);const P=u.compileScript(w,b),T=(t,r)=>{const s=t.$view?.timeZone;if(\"$view\"in t&&t.$view){let r;if(D.setField(\"scale\",\"object\"==typeof t.$view&&\"scale\"in t.$view?t.$view.scale:void 0),\"object\"==typeof t.$view&&\"timeProperties\"in t.$view&&null!=t.$view.timeProperties){const{currentStart:i,currentEnd:a}=t.$view.timeProperties;r=new f({currentStart:null!=i?null!=s?e.epochToArcadeDate(i,s):e.unknownEpochToArcadeDate(i):void 0,currentEnd:null!=a?null!=s?e.epochToArcadeDate(a,s):e.unknownEpochToArcadeDate(a):void 0,startIncluded:!0,endIncluded:!0})}D.setField(\"timeProperties\",r),t.$view=D}return v&&(t.$config=v),P({vars:t,spatialReference:h,services:r,timeZone:s})};return new d(r,u,w,T,new m,n,h)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}references(e){return this._dependencies.get(e)??!1}}export{d as ArcadeExpression,n as collectExpressionDependencies,u as createDictionaryExpression,l as createLabelExpression,p as createRendererExpression,o as loadArcade};\n"],
  "mappings": "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",
  "names": ["n", "s", "i", "a", "n", "c", "p", "u", "m", "g", "r"]
}
