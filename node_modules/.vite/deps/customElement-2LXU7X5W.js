import {
  ht,
  tt,
  ut,
  wt
} from "./chunk-VQ5234AM.js";
import "./chunk-S3EVYUV4.js";
import {
  S
} from "./chunk-B7E2AREE.js";
import {
  LitElement,
  createEvent,
  css,
  html,
  setAttribute
} from "./chunk-MALSDV7D.js";
import "./chunk-EWTE5DHJ.js";

// node_modules/@esri/calcite-components/dist/components/calcite-tree/customElement.js
function g(h) {
  return (h == null ? void 0 : h.tagName) === "CALCITE-TREE-ITEM";
}
function w(h) {
  return Array.from(h.querySelectorAll("calcite-tree-item:not([disabled])")).filter(
    (t) => {
      let e = t;
      for (; e !== h && e !== void 0; ) {
        const i = e.parentElement;
        if (!(!g(i) || !i.hasChildren || i.expanded))
          return false;
        e = e.parentElement;
      }
      return true;
    }
  );
}
var D = css`:host{display:block}:host(:focus){outline:2px solid transparent;outline-offset:2px}:host([hidden]){display:none}[hidden]{display:none}`;
var _k = class _k extends LitElement {
  // #endregion
  // #region Lifecycle
  constructor() {
    super(), this.items = [], this.lines = false, this.parentExpanded = false, this.scale = "m", this.selectedItems = [], this.selectionMode = "single", this.calciteTreeSelect = createEvent({ cancelable: false }), this.listen("focus", this.onFocus), this.listen("focusin", this.onFocusIn), this.listen("focusout", this.onFocusOut), this.listen("calciteInternalTreeItemSelect", this.onInternalTreeItemSelect), this.listen("keydown", this.keyDownHandler);
  }
  willUpdate(t) {
    var _a;
    t.has("parentExpanded") && (this.hasUpdated || this.parentExpanded !== false) && this.updateItems();
    const e = (_a = this.el.parentElement) == null ? void 0 : _a.closest("calcite-tree");
    this.lines = e ? e.lines : this.lines, this.scale = e ? e.scale : this.scale, this.selectionMode = e ? e.selectionMode : this.selectionMode, this.child = !!e;
  }
  // #endregion
  // #region Private Methods
  onFocus() {
    if (!this.child) {
      const t = this.el.querySelector("calcite-tree-item[selected]:not([disabled])") || this.el.querySelector("calcite-tree-item:not([disabled])");
      tt(t);
    }
  }
  onFocusIn(t) {
    (t.relatedTarget === this.el || !this.el.contains(t.relatedTarget)) && this.el.removeAttribute("tabindex");
  }
  onFocusOut(t) {
    !this.el.contains(t.relatedTarget) && (this.el.tabIndex = this.getRootTabIndex());
  }
  onInternalTreeItemSelect(t) {
    if (this.child)
      return;
    const e = t.target, i = ht(e.querySelectorAll("calcite-tree-item"));
    if (t.preventDefault(), t.stopPropagation(), this.selectionMode === "ancestors") {
      this.updateAncestorTree(t);
      return;
    }
    const o = this.selectionMode === "none", n = this.selectionMode !== null && (!e.hasChildren || e.hasChildren && (this.selectionMode === "children" || this.selectionMode === "multichildren")), l = this.selectionMode === "multichildren" && e.hasChildren, c = !o && t.detail.modifyCurrentSelection && (this.selectionMode === "multiple" || this.selectionMode === "multichildren"), u = !c && ((this.selectionMode === "single" || this.selectionMode === "multiple") && i.length <= 0 || this.selectionMode === "children" || this.selectionMode === "multichildren" || this.selectionMode === "single-persist" && !e.hasChildren), a = ["multiple", "none", "single", "single-persist"].includes(this.selectionMode) && e.hasChildren, d = [];
    n && d.push(e), u && ht(this.el.querySelectorAll("calcite-tree-item[selected]")).forEach((r) => {
      d.includes(r) || (r.selected = false);
    }), a && ["multiple", "none", "single", "single-persist"].includes(this.selectionMode) && (e.expanded = !e.expanded), l && i.forEach((s) => {
      s.selected = false, s.hasChildren && (s.expanded = false);
    }), c && window.getSelection().removeAllRanges(), c && e.selected ? d.forEach((s) => {
      s.disabled || (s.selected = false);
    }) : o || d.forEach((s) => {
      s.disabled || (s.selected = this.selectionMode !== "single" || !s.selected);
    }), this.selectedItems = o ? [] : ht(this.el.querySelectorAll("calcite-tree-item")).filter((s) => s.selected), this.calciteTreeSelect.emit(), t.stopPropagation();
  }
  keyDownHandler(t) {
    var _a, _b, _c, _d;
    if (this.child)
      return;
    const e = this.el, i = t.target, o = ["ArrowRight", "ArrowDown", "ArrowLeft", "ArrowUp", "Home", "End", "Tab"];
    if (!(g(i) && this.el.contains(i)) || !o.includes(t.key))
      return;
    const n = w(e);
    if (t.key === "Tab") {
      n.forEach((l) => l.tabIndex = -1);
      return;
    }
    if (t.key === "ArrowDown") {
      const l = n.indexOf(i);
      (_a = n[l + 1]) == null ? void 0 : _a.focus(), t.preventDefault();
      return;
    }
    if (t.key === "ArrowUp") {
      const l = n.indexOf(i);
      (_b = n[l - 1]) == null ? void 0 : _b.focus(), t.preventDefault();
      return;
    }
    if (t.key === "ArrowLeft") {
      if (i.hasChildren && i.expanded) {
        i.expanded = false, t.preventDefault();
        return;
      }
      (_c = n.slice(0, n.indexOf(i)).reverse().find((u) => u.depth === i.depth - 1)) == null ? void 0 : _c.focus(), t.preventDefault();
      return;
    }
    if (t.key === "ArrowRight") {
      if (!i.disabled && i.hasChildren)
        if (!i.expanded)
          i.expanded = true, t.preventDefault();
        else {
          const l = n.indexOf(i);
          (_d = n[l + 1]) == null ? void 0 : _d.focus(), t.preventDefault();
        }
      return;
    }
    if (t.key === "Home") {
      const l = n.shift();
      l && (l.focus(), t.preventDefault());
      return;
    }
    if (t.key === "End") {
      const l = n.pop();
      l && (l.focus(), t.preventDefault());
      return;
    }
  }
  updateAncestorTree(t) {
    const e = t.target, i = t.detail.updateItem;
    if (e.disabled || e.indeterminate && !i)
      return;
    const o = [];
    let n = e.parentElement.closest("calcite-tree-item");
    for (; n; )
      o.push(n), n = n.parentElement.closest("calcite-tree-item");
    const l = Array.from(e.querySelectorAll("calcite-tree-item:not([disabled])")), c = l.filter((s) => !s.hasChildren), u = l.filter((s) => s.hasChildren);
    let a;
    i ? a = e.hasChildren ? !(e.selected || e.indeterminate) : !e.selected : a = e.selected, c.forEach((s) => {
      s.selected = a, s.indeterminate = false;
    });
    function d(s, r) {
      const f = s.filter((m) => m.selected), I = s.filter((m) => !m.selected);
      r.selected = f.length === s.length, r.indeterminate = f.length > 0 && I.length > 0;
    }
    u.reverse().forEach((s) => {
      const r = Array.from(s.querySelectorAll(":scope > calcite-tree > calcite-tree-item"));
      d(r, s);
    }), i && (e.hasChildren ? d(l, e) : (e.selected = a, e.indeterminate = false)), o.forEach((s) => {
      const r = ht(s.querySelectorAll("calcite-tree-item")), f = r.filter((m) => m.selected);
      if (f.length === 0) {
        s.selected = false, s.indeterminate = false;
        return;
      }
      const I = f.length < r.length;
      s.indeterminate = I, s.selected = !I;
    }), this.selectedItems = ht(this.el.querySelectorAll("calcite-tree-item")).filter((s) => s.selected), i && this.calciteTreeSelect.emit();
  }
  updateItems() {
    this.items.forEach((t) => t.parentExpanded = this.parentExpanded);
  }
  handleDefaultSlotChange(t) {
    const e = ut(t).filter((i) => i.matches("calcite-tree-item"));
    this.items = e, this.updateItems();
  }
  getRootTabIndex() {
    return this.child ? -1 : 0;
  }
  // #endregion
  // #region Rendering
  render() {
    return this.el.ariaMultiSelectable = this.child ? void 0 : wt(this.selectionMode === "multiple" || this.selectionMode === "multichildren"), this.el.role = this.child ? void 0 : "tree", setAttribute(this.el, "tabIndex", this.getRootTabIndex()), html`<slot @slotchange=${this.handleDefaultSlotChange}></slot>`;
  }
};
_k.properties = { child: 7, lines: 7, parentExpanded: 5, scale: 3, selectedItems: 0, selectionMode: 3 };
_k.styles = D;
var k = _k;
S("calcite-tree", k);
export {
  k as Tree
};
/*! Bundled license information:

@esri/calcite-components/dist/components/calcite-tree/customElement.js:
  (*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
  See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
  v3.1.0 *)
*/
//# sourceMappingURL=customElement-2LXU7X5W.js.map
