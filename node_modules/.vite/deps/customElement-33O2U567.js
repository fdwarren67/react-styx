import {
  D,
  I
} from "./chunk-BMTY6R7M.js";
import {
  m,
  p as p2
} from "./chunk-VBBJGZOS.js";
import {
  debounce_default
} from "./chunk-F5MHH7JA.js";
import {
  m as m2
} from "./chunk-2GIEDWQ6.js";
import {
  b
} from "./chunk-6JIDXA46.js";
import {
  mt,
  p
} from "./chunk-VQ5234AM.js";
import "./chunk-PXZ2RU65.js";
import {
  i
} from "./chunk-S3EVYUV4.js";
import {
  M,
  S
} from "./chunk-B7E2AREE.js";
import {
  LitElement,
  createEvent,
  css,
  html,
  safeClassMap
} from "./chunk-MALSDV7D.js";
import "./chunk-EWTE5DHJ.js";

// node_modules/@esri/calcite-components/dist/components/calcite-block-group/customElement.js
function u(l) {
  return l.tagName === "CALCITE-BLOCK";
}
var d = {
  container: "container",
  groupContainer: "group-container",
  scrim: "scrim",
  assistiveText: "assistive-text"
};
var b2 = "calcite-block-group";
var g = "calcite-block";
var $ = css`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block}.container{position:relative}.assistive-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}`;
function w(l) {
  const e = l.assignedElements({ flatten: true }).filter((s) => s.matches(g));
  e.forEach((s) => {
    s.setPosition = e.indexOf(s) + 1, s.setSize = e.length;
  });
}
var _A = class _A extends LitElement {
  // #endregion
  // #region Lifecycle
  constructor() {
    super(), this.dragSelector = g, this.handleSelector = "calcite-sort-handle", this.mutationObserver = b("mutation", () => {
      this.updateBlockItems();
    }), this.updateBlockItems = debounce_default(() => {
      this.updateGroupItems();
      const { dragEnabled: e, el: s, moveToItems: o } = this;
      Array.from(this.el.querySelectorAll(g)).forEach((t) => {
        t.closest(b2) === s && (t.moveToItems = o.filter((n) => n.element !== s && !t.contains(n.element)), t.dragHandle = e);
      }), this.setUpSorting();
    }, M.nextTick), this.moveToItems = [], this.disabled = false, this.dragEnabled = false, this.loading = false, this.calciteBlockGroupDragEnd = createEvent({ cancelable: false }), this.calciteBlockGroupDragStart = createEvent({ cancelable: false }), this.calciteBlockGroupOrderChange = createEvent({ cancelable: false }), this.listen("calciteInternalAssistiveTextChange", this.handleCalciteInternalAssistiveTextChange), this.listen("calciteSortHandleReorder", this.handleSortReorder), this.listen("calciteSortHandleMove", this.handleSortMove);
  }
  // #endregion
  // #region Public Methods
  /**
   * Sets focus on the component's first focusable element.
   *
   * @returns {Promise<void>}
   */
  async setFocus() {
    await m2(this), mt(this.el);
  }
  connectedCallback() {
    super.connectedCallback(), this.connectObserver(), this.updateBlockItems(), this.setUpSorting(), this.setParentBlockGroup();
  }
  willUpdate(e) {
    (e.has("group") || e.has("dragEnabled") && (this.hasUpdated || this.dragEnabled !== false)) && this.updateBlockItems();
  }
  updated() {
    m(this);
  }
  disconnectedCallback() {
    super.disconnectedCallback(), this.disconnectObserver(), D(this);
  }
  // #endregion
  // #region Private Methods
  updateGroupItems() {
    const { el: e, group: s } = this, o = p(e), a = s ? Array.from(o.querySelectorAll(`${b2}[group="${s}"]`)).filter((t) => !t.disabled && t.dragEnabled) : [];
    this.moveToItems = a.map((t) => ({
      element: t,
      label: t.label ?? t.id,
      id: i()
    }));
  }
  handleCalciteInternalAssistiveTextChange(e) {
    this.assistiveText = e.detail.message, e.stopPropagation();
  }
  handleSortReorder(e) {
    this.parentBlockGroupEl || this.handleReorder(e);
  }
  handleSortMove(e) {
    this.parentBlockGroupEl || this.handleMove(e);
  }
  connectObserver() {
    var _a;
    (_a = this.mutationObserver) == null ? void 0 : _a.observe(this.el, { childList: true, subtree: true });
  }
  disconnectObserver() {
    var _a;
    (_a = this.mutationObserver) == null ? void 0 : _a.disconnect();
  }
  setUpSorting() {
    const { dragEnabled: e } = this;
    e && I(this);
  }
  onGlobalDragStart() {
    this.disconnectObserver();
  }
  onGlobalDragEnd() {
    this.connectObserver();
  }
  onDragEnd(e) {
    this.calciteBlockGroupDragEnd.emit(e);
  }
  onDragStart(e) {
    e.dragEl.sortHandleOpen = false, this.calciteBlockGroupDragStart.emit(e);
  }
  onDragSort(e) {
    this.setParentBlockGroup(), this.updateBlockItems(), this.calciteBlockGroupOrderChange.emit(e);
  }
  setParentBlockGroup() {
    var _a;
    this.parentBlockGroupEl = (_a = this.el.parentElement) == null ? void 0 : _a.closest(b2);
  }
  handleDefaultSlotChange(e) {
    w(e.target);
  }
  handleMove(e) {
    const { moveTo: s } = e.detail, o = e.target, a = o == null ? void 0 : o.parentElement, t = s.element, r = Array.from(a.children).filter(u).indexOf(o);
    if (!a)
      return;
    o.sortHandleOpen = false, this.disconnectObserver(), t.prepend(o);
    const h = Array.from(t.children).filter(u).indexOf(o);
    this.updateBlockItems(), this.connectObserver(), this.calciteBlockGroupOrderChange.emit({
      dragEl: o,
      fromEl: a,
      toEl: t,
      newIndex: h,
      oldIndex: r
    });
  }
  handleReorder(e) {
    const { reorder: s } = e.detail, o = e.target, a = o == null ? void 0 : o.parentElement;
    if (!a)
      return;
    o.sortHandleOpen = false;
    const t = Array.from(a.children).filter(u), n = t.length - 1, r = t.indexOf(o);
    let i2 = r;
    switch (s) {
      case "top":
        i2 = 0;
        break;
      case "bottom":
        i2 = n;
        break;
      case "up":
        i2 = r === 0 ? 0 : r - 1;
        break;
      case "down":
        i2 = r === n ? n : r + 1;
        break;
    }
    this.disconnectObserver();
    const h = s === "up" || s === "top" ? t[i2] : t[i2].nextSibling;
    a.insertBefore(o, h), this.updateBlockItems(), this.connectObserver(), this.calciteBlockGroupOrderChange.emit({
      dragEl: o,
      fromEl: a,
      toEl: a,
      newIndex: i2,
      oldIndex: r
    });
  }
  // #endregion
  // #region Rendering
  render() {
    const { loading: e, label: s } = this;
    return p2({ disabled: this.disabled, children: html`<div class=${safeClassMap(d.container)}>${this.dragEnabled ? html`<span aria-live=assertive class=${safeClassMap(d.assistiveText)}>${this.assistiveText}</span>` : null}${e ? html`<calcite-scrim class=${safeClassMap(d.scrim)} .loading=${e}></calcite-scrim>` : null}<div .ariaBusy=${e} .ariaLabel=${s || ""} class=${safeClassMap(d.groupContainer)} role=group><slot @slotchange=${this.handleDefaultSlotChange}></slot></div></div>` });
  }
};
_A.properties = { assistiveText: 16, moveToItems: 16, canPull: 0, canPut: 0, disabled: 7, dragEnabled: 7, group: 3, label: 1, loading: 7 };
_A.styles = $;
var A = _A;
S("calcite-block-group", A);
export {
  A as BlockGroup
};
/*! Bundled license information:

@esri/calcite-components/dist/components/calcite-block-group/customElement.js:
  (*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
  See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
  v3.1.0 *)
*/
//# sourceMappingURL=customElement-33O2U567.js.map
