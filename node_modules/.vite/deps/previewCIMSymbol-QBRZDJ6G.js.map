{
  "version": 3,
  "sources": ["../../@arcgis/core/symbols/support/previewCIMSymbol.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{px2pt as e,pt2px as t}from\"../../core/screenUtils.js\";import{CIMSymbolHelper as i}from\"../cim/CIMSymbolHelper.js\";import{CIMSymbolRasterizer as l}from\"../cim/CIMSymbolRasterizer.js\";import{OverrideHelper as r}from\"../cim/OverrideHelper.js\";import{mapCIMSymbolToGeometryType as o}from\"../cim/utils.js\";import{SymbolSizeDefaults as n}from\"./previewUtils.js\";import{renderSymbol as a}from\"./renderUtils.js\";const s=new l(null),m=e(n.size),h=e(n.maxSize),c=e(n.lineWidth),y=1;async function u(e,t,i){const l=t?.size;let r=null!=l&&\"object\"==typeof l&&\"width\"in l?l.width:l,o=null!=l&&\"object\"==typeof l&&\"height\"in l?l.height:l;if(null==r||null==o)if(\"esriGeometryPolygon\"===i)r=o=t.maxSize?Math.min(t.maxSize,m):m;else{const l=await f(e,t,i);l&&(r=l.width,o=l.height),\"esriGeometryPolyline\"===i&&(r=t.maxSize?Math.min(t.maxSize,c):c),r=null!=r&&isFinite(r)?Math.min(r,h):m,o=null!=o&&isFinite(o)?Math.max(Math.min(o,h),y):m}return\"legend\"===t.style&&\"esriGeometryPolyline\"===i&&(r=c),{width:r,height:o}}async function f(e,t,l){const{feature:o,fieldMap:n,viewParams:a}=t.cimOptions||t,m=await r.resolveSymbolOverrides(e.data,o,null,n,l,null,a);if(!m)return null;(e=e.clone()).data={type:\"CIMSymbolReference\",symbol:m},e.data.primitiveOverrides=void 0;const h=[];return i.fetchResources(m,s.resourceManager,h),i.fetchFonts(m,s.resourceManager,h),h.length>0&&await Promise.all(h),i.getEnvelope(m,null,s.resourceManager)}async function g(i,l={}){const{node:r,opacity:n,symbolConfig:m}=l,h=null!=m&&\"object\"==typeof m&&\"isSquareFill\"in m&&m.isSquareFill,c=l.cimOptions||l,y=c.geometryType||o(i?.data?.symbol),f=await u(i,l,y),{feature:g,fieldMap:d}=c,p=l?.geometry||h||\"esriGeometryPolygon\"!==y?\"preview\":\"legend\";let w=f;const b=f;if(l?.geometry&&(\"esriGeometryPolygon\"===y||\"esriGeometryPolyline\"===y)){const i=200;if(t(f.width)<i||t(f.height)<i){const t=f.width>f.height?e(i)*f.height/f.width:e(i);w={width:f.width>f.height?e(i):e(i)*f.width/f.height,height:t}}}const M=await s.rasterizeCIMSymbolAsync(i,g,w,p,d,y,null,c.viewParams,c.allowScalingUp,l?.geometry?.toJSON());if(!M)return null;const{width:S,height:v}=M,j=document.createElement(\"canvas\");j.width=S,j.height=v;j.getContext(\"2d\").putImageData(M,0,0);const x=t(b.width),z=t(b.height),P=new Image(x,z);P.src=j.toDataURL(),P.ariaLabel=l.ariaLabel??null,P.alt=l.ariaLabel??\"\",null!=n&&(P.style.opacity=`${n}`);let C=P;if(null!=l.effectView){const e={shape:{type:\"image\",x:0,y:0,width:x,height:z,src:P.src},fill:null,stroke:null,offset:[0,0]};C=a([[e]],[x,z],{effectView:l.effectView,ariaLabel:l.ariaLabel})}return r&&C&&r.appendChild(C),C}export{g as previewCIMSymbol};\n"],
  "mappings": "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",
  "names": ["l", "y", "u", "e", "t", "m", "h", "c", "f", "g", "i"]
}
